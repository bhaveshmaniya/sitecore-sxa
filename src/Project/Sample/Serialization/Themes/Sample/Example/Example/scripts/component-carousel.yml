---
ID: "d9bbb20e-0865-4336-85ef-6633e2704e5e"
Parent: "c5a1d44e-ed67-425b-9024-241961d0ca59"
Template: "962b53c4-f93b-4df9-9821-415c867b8903"
Path: "/sitecore/media library/Themes/Sample/Example/Example/scripts/component-carousel"
DB: master
SharedFields:
- ID: "06d5295c-ed2f-4a54-9bf2-26228d113318"
  Hint: __Icon
  Value: "-/media/35F24F1601B441E68B7F83CE6717579E.ashx?h=16&thn=1&w=16"
- ID: "40e50ed9-ba07-4702-992e-a912738d32dc"
  Hint: Blob
  BlobID: "66901627-b6d6-471c-9ad6-a3cf523804de"
  Value: LyoqDQogKiBYQUNvbnRleHQNCiAqDQogKiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzIG1vZHVsZS4NCiAqDQogKiBFeHBvc2VzIHJlZ2lzdGVyKHNlbGVjdG9yLCBvcHRpb25zKSBtZXRob2QsIHdoaWNoIGluaXRpYWxpemVzIENhcm91c2VsDQogKiBmb3IgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3Rvciwgd2l0aCBnaXZlbiBvcHRpb25zLg0KICogRWxlbWVudCB1c2VkIGFzIGEgY2Fyb3VzZWwgbXVzdCBjb250YWluIGEgPHVsIGNsYXNzPSJzbGlkZXMiPiB0YWcuDQogKiBUaGF0IHRhZyBoYXZlIHRvIGJlIGZpbGxlZCB3aXRoIDxsaT4gZWxlbWVudHMuIEVhY2ggPGxpPiBlbGVtZW50IHdpbGwgYmUgY29uc2lkZXJlZCBhcyBhIHNsaWRlLg0KICogRm9yIG1vcmUgZGV0YWlscyByZWFkIHRoZSBkb2N1bWVudGF0aW9uIG9mIGEgcmVnaXN0ZXIoc2VsZWN0b3IsIG9wdGlvbnMpIG1ldGhvZC4NCiAqDQogKiBAcmVxdWlyZXMgalF1ZXJ5IEphdmFTY3JpcHQgTGlicmFyeSB2MS40LjQgb3IgaGlnaGVyDQogKi8NCi8qIGdsb2JhbCBIYW1tZXI6dHJ1ZSAqLw0KWEEuY29tcG9uZW50LmNhcm91c2VscyA9IChmdW5jdGlvbigkKSB7DQogICAgdmFyIHB1YiA9IHt9LA0KICAgICAgICBOYXZpZ2F0aW9uQnVpbGRlciA9IG51bGwsDQogICAgICAgIFNsaWRlckluaXRpYWxpemVyID0gbnVsbDsNCg0KICAgIC8qKg0KICAgICAqIFRpbWVyIGNsYXNzIHNhdmVzIHRpbWUgc3RhbXAgYW5kIGNvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2Vlbg0KICAgICAqIGN1cnJlbnQgdGltZSAodXBkYXRlKCkgbWV0aG9kKSBhbmQgc2F2ZWQgdGltZSBzdGFtcC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUaW1lcigpIHsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGxhc3QgdXBkYXRlKCkgY2FsbCBhbmQgbGFzdCBzZXQoKSBjYWxsDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZWxhcHNlZCA9IDA7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBUaW1lIHN0YW1wDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc3RhbXAgPSBudWxsOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqICBDb3VudHMgdGltZSBkaWZmZXJlbmNlIGJldHdlZW4gY3VycmVudCB0aW1lIGFuZCBzYXZlZCB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBpZiAodGhpcy5zdGFtcCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgdGhpcy5lbGFwc2VkICs9IHRoaXMubmV3U3RhbXAoKSAtIHRoaXMuc3RhbXA7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogIFNhdmVzIG5ldyB0aW1lIHN0YW1wDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVyDQogICAgICovDQogICAgVGltZXIucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnN0YW1wID0gdGhpcy5uZXdTdGFtcCgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgQ291bnRzIHRpbWUgZGlmZmVyZW5jZSBiZXR3ZWVuIGN1cnJlbnQgdGltZSBhbmQgc2F2ZWQgdGltZSBzdGFtcA0KICAgICAqDQogICAgICogQG1lbWJlciBUaW1lcg0KICAgICAqIEByZXR1cm4gc3RhbXAgb2YgYSBjdXJyZW50IHRpbWUNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUubmV3U3RhbXAgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgcmV0dXJuIG5ldyBEYXRlKCkudmFsdWVPZigpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiAgUmVzZXRzIGVsYXBzZWQgdGltZS4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXINCiAgICAgKi8NCiAgICBUaW1lci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5lbGFwc2VkID0gMDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEVuZCBvZiBUaW1lciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogVGltZUluZGljYXRvciBjbGFzcyBleHRlbmRzIFRpbWVyIGNsYXNzDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtPYmplY3R9ICQgICAgIGEgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7WEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3fSB2aWV3ICBhIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHZpZXcgdGltZW91dA0KICAgICAqIEBiYXNlIFRpbWVyDQogICAgICovDQogICAgZnVuY3Rpb24gVGltZUluZGljYXRvcigkLCB2aWV3LCB0aW1lb3V0KSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBBIHRpbWUgaW5kaWNhdG9yIHZpZXcuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgICAgICovDQogICAgICAgIHRoaXMudmlldyA9IHZpZXc7DQoNCiAgICAgICAgdGhpcy52aWV3LmluaXQodGltZW91dCk7DQogICAgfQ0KICAgIFRpbWVJbmRpY2F0b3IucHJvdG90eXBlID0gbmV3IFRpbWVyKCk7DQogICAgVGltZUluZGljYXRvci5jb25zdHJ1Y3RvciA9IFRpbWVyOw0KDQogICAgLyoqDQogICAgICogUGxheXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLnZpZXcucGxheSgpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIGF0dGFjaGVkIHZpZXcuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFRpbWVySW5kaWNhdG9yDQogICAgICovDQogICAgVGltZUluZGljYXRvci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy52aWV3LnBhdXNlKCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyBlbGFwc2VkIHRpbWUgYW5kIHJlc2V0cyB0aGUgYXR0YWNoZWQgdmlldy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICBUaW1lci5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCiAgICAgICAgdGhpcy52aWV3LnJlc2V0KCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENvdW50cyB0aW1lIGRpZmZlcmVuY2UgYmV0d2VlbiBjdXJyZW50IHRpbWUgYW5kIHNhdmVkIHRpbWUgc3RhbXAuDQogICAgICogYW5kIHVwZGF0ZXMgdGhlIGF0dGFjaGVkIHZpZXcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVGltZXJJbmRpY2F0b3INCiAgICAgKi8NCiAgICBUaW1lSW5kaWNhdG9yLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVGltZXIucHJvdG90eXBlLnVwZGF0ZS5jYWxsKHRoaXMpOw0KICAgICAgICB0aGlzLnZpZXcudXBkYXRlKHRoaXMuZWxhcHNlZCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBlbmQgb2YgVGltZUluZGljYXRvciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogTmF2aWdhdGlvbkJ1aWxkZXIgb2JqZWN0IGNyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqLw0KICAgIE5hdmlnYXRpb25CdWlsZGVyID0gKGZ1bmN0aW9uKCQpIHsNCiAgICAgICAgZnVuY3Rpb24gY3JlYXRlSXRlbShzZXR0aW5ncykgew0KICAgICAgICAgICAgdmFyIHRleHQgPSBzZXR0aW5ncy50ZXh0LA0KICAgICAgICAgICAgICAgICRuYXZJdGVtID0gbnVsbDsNCg0KICAgICAgICAgICAgc2V0dGluZ3MudGV4dCA9ICcnOw0KICAgICAgICAgICAgc2V0dGluZ3MuaHJlZiA9ICcjJzsNCg0KICAgICAgICAgICAgJG5hdkl0ZW0gPSAkKCc8YT4nLCBzZXR0aW5ncyk7DQogICAgICAgICAgICAkKCc8c3Bhbj4nLCB7DQogICAgICAgICAgICAgICAgJ3RleHQnOiB0ZXh0DQogICAgICAgICAgICB9KS5hcHBlbmRUbygkbmF2SXRlbSk7DQoNCiAgICAgICAgICAgIHJldHVybiAkbmF2SXRlbTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIFJldHVybnMgdGhlIGVsZW1lbnQocykgdGhhdCBtYXRjaChlcykgdGhlIHByb3ZpZGVkIHNlbGVjdG9yIG9yIG51bGwNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgICAgICAgICAqIEByZXR1cm4gYSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudChzKSB0aGF0IG1hdGNoKGVzKSB0aGUgcHJvdmlkZWQgc2VsZWN0b3Igb3IgbnVsbCBpZiBubyBlbGVtZW50IG1hdGNoDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgZ2V0RWxlbWVudDogZnVuY3Rpb24oc2VsZWN0b3IpIHsNCiAgICAgICAgICAgICAgICB2YXIgJGVsZW1lbnQgPSAkKHNlbGVjdG9yKTsNCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudC5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSBudWxsOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHJldHVybiAkZWxlbWVudDsNCiAgICAgICAgICAgIH0sDQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIENyZWF0ZXMgbmF2aWdhdGlvbiBpdGVtcyBhbmQgYXBwZW5kcyB0aGVtIHRvICRjb250YWluZXIuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEBwYXJhbSB7U3RyaW5nfSBsYWJlbCAgIG5hdmlnYXRpb24gaXRlbXMgbGFiZWwgdGVtcGxhdGUNCiAgICAgICAgICAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb3VudCAgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcyB0byBjcmVhdGUNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlSXRlbXM6IGZ1bmN0aW9uKCRjb250YWluZXIsIGxhYmVsLCBjb3VudCkgew0KICAgICAgICAgICAgICAgIHZhciBpLA0KICAgICAgICAgICAgICAgICAgICBwYXR0ZXJuID0gLyNce2luZGV4XH0vZywNCiAgICAgICAgICAgICAgICAgICAgc2V0dGluZ3M7DQoNCiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICBzZXR0aW5ncyA9IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogbGFiZWwucmVwbGFjZShwYXR0ZXJuLCBpICsgMSkNCiAgICAgICAgICAgICAgICAgICAgfTsNCiAgICAgICAgICAgICAgICAgICAgY3JlYXRlSXRlbShzZXR0aW5ncykuYXBwZW5kVG8oJGNvbnRhaW5lcik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSwNCiAgICAgICAgICAgIC8qKg0KICAgICAgICAgICAgICogQ3JlYXRlcyBvciBzZWxlY3RzICdwcmV2aW91cycvJ25leHQnIG5hdmlnYXRpb24gaXRlbS4NCiAgICAgICAgICAgICAqIE1vZGUgb2YgYWN0aW9uIGRlcGVuZHMgb24gc2V0dGluZ3Mgb2JqZWN0Og0KICAgICAgICAgICAgICogdmFyIHNldHRpbmdzID0gew0KICAgICAgICAgICAgICogICAgIGlzQ29udGFpbmVyOiBCb29sZWFuIHZhbHVlLA0KICAgICAgICAgICAgICogICAgIGxhYmVsOiBTdHJpbmcgdmFsdWUsDQogICAgICAgICAgICAgKiAgICAgc2VsZWN0b3I6IFN0cmluZyB2YWx1ZSwNCiAgICAgICAgICAgICAqICAgICBtZXRob2Q6IFN0cmluZyB2YWx1ZQ0KICAgICAgICAgICAgICogfTsNCiAgICAgICAgICAgICAqDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciA9PT0gbnVsbCBvciBpZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gdHJ1ZQ0KICAgICAgICAgICAgICogbmF2aWdhdGlvbiBpdGVtIGlzIGNyZWF0ZWQgYW5kIGF0dGFjaGVkIHRvICRlbGVtZW50LmZpcnN0KCkgKHVzaW5nIHNldHRpbmdzLm1ldGhvZCkuDQogICAgICAgICAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBhbmQgc2V0dGluZ3MuaXNDb250YWluZXIgPT0gZmFsc2UNCiAgICAgICAgICAgICAqICRlbGVtZW50LmZpcnN0KCkgaXMgc2VsZWN0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAgICAgICAgICogQHBhcmFtIHtPYmplY3R9IGl0ZW1TZXR0aW5ncyAgIGh0bWwgYXR0cmlidXRlcyBvZiBuYXZpZ2F0aW9uIGl0ZW0NCiAgICAgICAgICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkZWxlbWVudCAgICBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciAoalF1ZXJ5IG9iamVjdCkNCiAgICAgICAgICAgICAqIEByZXR1cm4gVGhlICdwcmV2Jy8nbmV4dCcgbmF2aWdhdGlvbiBpdGVtDQogICAgICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICAgICAqLw0KICAgICAgICAgICAgY3JlYXRlUHJldk5leHRJdGVtOiBmdW5jdGlvbihzZXR0aW5ncywgaXRlbVNldHRpbmdzLCAkZWxlbWVudCkgew0KICAgICAgICAgICAgICAgIHZhciAkaXRlbSA9IG51bGwsDQogICAgICAgICAgICAgICAgICAgIGlzU2VsZWN0b3JFeGlzdHMgPSBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbDsNCg0KDQogICAgICAgICAgICAgICAgaWYgKGlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgJGVsZW1lbnQgPSB0aGlzLmdldEVsZW1lbnQoc2V0dGluZ3Muc2VsZWN0b3IpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGlmICgkZWxlbWVudCAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuaXNDb250YWluZXIgfHwgIWlzU2VsZWN0b3JFeGlzdHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICRpdGVtID0gY3JlYXRlSXRlbSgkLmV4dGVuZCh7fSwgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0ZXh0Jzogc2V0dGluZ3MubGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICAgIH0sIGl0ZW1TZXR0aW5ncykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgKCRlbGVtZW50LmZpcnN0KCkpW3NldHRpbmdzLm1ldGhvZF0oJGl0ZW0pOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgJGl0ZW0gPSAkZWxlbWVudC5maXJzdCgpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuICRpdGVtOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgIH0oJCkpOw0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBOYXZpZ2F0aW9uQnVpbGRlciBvYmplY3QNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIE5hdmlnYXRpb24gY2xhc3MgaG9sZHMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBOYXZpZ2F0aW9uKCQsICR3cmFwcGVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICAgICAnaXNFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICAgICAnaGFzUHJldk5leHRJdGVtcyc6IHRydWUsDQogICAgICAgICAgICAgICAgJ2l0ZW0nOiB7DQogICAgICAgICAgICAgICAgICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgICdwcmV2SXRlbSc6IHsNCiAgICAgICAgICAgICAgICAgICAgJ2xhYmVsJzogJzwnLA0KICAgICAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAgICAgICAgICAgIH0sDQogICAgICAgICAgICAgICAgJ25leHRJdGVtJzogew0KICAgICAgICAgICAgICAgICAgICAnbGFiZWwnOiAnPicsDQogICAgICAgICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAnc2xpZGVzQ291bnQnOiAwDQogICAgICAgICAgICB9LA0KICAgICAgICAgICAgc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0DQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kID0gJDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gaXRlbXMgKG9uZSBmb3IgZWFjaCBzbGlkZSBpZiBuYXZpZ2F0aW9uIGlzIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJGl0ZW1zID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogTmF2aWdhdGlvbiAnbmV4dCcgaXRlbSAoaWYgcHJldi9uZXh0IGl0ZW1zIGFyZSBlbmFibGVkKS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRuZXh0SXRlbSA9ICQoKTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIE5hdmlnYXRpb24gJ3ByZXZpb3VzJyBpdGVtIChpZiBwcmV2L25leHQgaXRlbXMgYXJlIGVuYWJsZWQpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHByZXZJdGVtID0gJCgpOw0KICAgICAgICAvKioNCiAgICAgICAgICogU2VsZWN0ZWQgaXRlbSAob25lIGZyb20gdGhpcy4kaXRlbXMgb3IgbnVsbCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kc2VsZWN0ZWRJdGVtID0gbnVsbDsNCg0KICAgICAgICAvL2luaXRpYWxpemF0aW9uDQogICAgICAgIGlmIChzZXR0aW5ncy5pc0VuYWJsZWQpIHsNCiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpczsNCiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgc2VsZi5wcmVwYXJlSXRlbXMoc2V0dGluZ3MuaXRlbSwgc2V0dGluZ3Muc2xpZGVzQ291bnQsICR3cmFwcGVyKTsNCiAgICAgICAgICAgICAgICAvL3NlbGVjdCBmaXJzdCBpdGVtIG9uIGluaXQNCiAgICAgICAgICAgICAgICBzZWxmLnNlbGVjdEl0ZW0oMCkNCiAgICAgICAgICAgIH0sIDEwMDApOw0KDQogICAgICAgICAgICAkd3JhcHBlci5maW5kKCcubmF2JykudHJpZ2dlcignbmF2aWdhdGlvbi1jcmVhdGVkJywgdGhpcyk7DQoNCg0KICAgICAgICB9DQogICAgfQ0KDQogICAgLyoqDQogICAgICogQ1NTIGNsYXNzbSB3aGljaCB3aWxsIGJlIHVzZWQgZm9yIG1hcmsgc2VsZWN0ZWQgaXRlbQ0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUuc2VsZWN0ZWRJdGVtQ2xhc3MgPSAnYWN0aXZlJzsNCg0KICAgIC8qKg0KICAgICAqIE1hcmsgbmF2aWdhdGlvbiBpdGVtIHdpdGggZ2l2ZW4gaW5kZXggYXMgc2VsZWN0ZWQuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgKiBAcGFyYW0ge051bWJlcn0gaW5kZXggICAgIGluZGV4IG9mIG5hdmlnYXRpb24gaXRlbQ0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnNlbGVjdEl0ZW0gPSBmdW5jdGlvbihpbmRleCkgew0KICAgICAgICBpZiAodGhpcy4kc2VsZWN0ZWRJdGVtICE9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0ucmVtb3ZlQ2xhc3ModGhpcy5zZWxlY3RlZEl0ZW1DbGFzcyk7DQogICAgICAgIH0NCg0KICAgICAgICB0aGlzLiRzZWxlY3RlZEl0ZW0gPSB0aGlzLiRpdGVtcy5lcShpbmRleCkuYWRkQ2xhc3ModGhpcy5zZWxlY3RlZEl0ZW1DbGFzcyk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENyZWF0ZXMgb3Igc2VsZWN0cyBuYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBhbmQgZmlsbHMgaXQgd2l0aCBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIElmIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGlzIG5vdCBlbXB0eSwgY2hpbGQgZWxlbWVudHMgYXJlIGFkb3B0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKiBNb2RlIG9mIGFjdGlvbiBkZXBlbmRzIG9uIHNldHRpbmdzIG9iamVjdDoNCiAgICAgKiB2YXIgc2V0dGluZ3MgPSB7DQogICAgICogICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICogICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgKiB9Ow0KICAgICAqIElmIHNldHRpbmdzLnNlbGVjdG9yID09PSBudWxsIG5hdmlnYXRpb24gaXRlbSBjb250YWluZXIgaXMgY3JlYXRlZC4NCiAgICAgKiBJZiBzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCBlbGVtZW50IHRoYXQgbWF0Y2ggc2V0dGluZ3Muc2VsZWN0b3IgaXMgYWRhcHRlZCBhcyBuYXZpZ2FnYXRpb24gaXRlbXMgY29udGFpbmVyLg0KICAgICAqDQogICAgICogQG1lbWJlciBOYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9IHNldHRpbmdzIHNldHRpbmdzIG9mIG5hdmlnYXRpb24gaXRlbXMNCiAgICAgKiBAcGFyYW0ge051bWJlcn0gY291bnQgICBudW1iZXIgb2YgbmF2aWdhdGlvbiBpdGVtcw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkd3JhcHBlciAgICB3cmFwcGVyIG9mIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqIEByZXR1cm4gVGhlIGNvbnRhaW5lciBmaWxsZWQgd2l0aCBuYXZpZ2F0aW9uIGl0ZW1zLg0KICAgICAqIEB0eXBlIE9iamVjdA0KICAgICAqLw0KICAgIE5hdmlnYXRpb24ucHJvdG90eXBlLnByZXBhcmVJdGVtcyA9IGZ1bmN0aW9uKHNldHRpbmdzLCBjb3VudCwgJHdyYXBwZXIpIHsNCiAgICAgICAgdmFyICRjb250YWluZXIgPSBudWxsOw0KDQogICAgICAgIGlmIChzZXR0aW5ncy5zZWxlY3RvciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgJGNvbnRhaW5lciA9IE5hdmlnYXRpb25CdWlsZGVyLmdldEVsZW1lbnQoc2V0dGluZ3Muc2VsZWN0b3IpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgJGNvbnRhaW5lciA9ICQoJzxkaXYvPicsIHsNCiAgICAgICAgICAgICAgICAnY2xhc3MnOiAnbmF2Jw0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAkY29udGFpbmVyLmFwcGVuZFRvKCR3cmFwcGVyKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICgkY29udGFpbmVyICE9PSBudWxsKSB7DQogICAgICAgICAgICBpZiAoJGNvbnRhaW5lci5jaGlsZHJlbigpLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgIE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZUl0ZW1zKCRjb250YWluZXIsIHNldHRpbmdzLmxhYmVsLCBjb3VudCk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICB0aGlzLiRpdGVtcyA9ICRjb250YWluZXIuY2hpbGRyZW4oKS5zbGljZSgwLCBjb3VudCk7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gJGNvbnRhaW5lcjsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ3JlYXRlcyBvciBzZWxlY3RzIG5hdmlnYXRpb24gJ3ByZXZpb3VzJyBhbmQgJ25leHQnIG5hdmlnYXRpb24gaXRlbXMgKEBzZWUgTmF2aWdhdGlvbkJ1aWxkZXIuY3JlYXRlUHJldk5leHRJdGVtKCkpLg0KICAgICAqIElmIG5hdmlnYXRpb24gaXRlbXMgY29udGFpbmVyIGlzIG5vdCBlbXB0eSwgY2hpbGQgZWxlbWVudHMgYXJlIGFkb3B0ZWQgYXMgbmF2aWdhdGlvbiBpdGVtcy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgTmF2aWdhdGlvbg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBzZXR0aW5ncyBzZXR0aW5ncyBvZiBuYXZpZ2F0aW9uDQogICAgICogQHBhcmFtIHtPYmplY3R9ICRjb250YWluZXIgICAgbmF2aWdhdGlvbiBpdGVtcyBjb250YWluZXIgKGpRdWVyeSBvYmplY3QpDQogICAgICovDQogICAgTmF2aWdhdGlvbi5wcm90b3R5cGUucHJlcGFyZVByZXZOZXh0SXRlbXMgPSBmdW5jdGlvbihzZXR0aW5ncywgJGNvbnRhaW5lcikgew0KICAgICAgICB2YXIgJGl0ZW07DQoNCiAgICAgICAgc2V0dGluZ3MucHJldkl0ZW0ubWV0aG9kID0gJ3ByZXBlbmQnOw0KICAgICAgICAkaXRlbSA9IE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbShzZXR0aW5ncy5wcmV2SXRlbSwgew0KICAgICAgICAgICAgJ2NsYXNzJzogJ3ByZXYnDQogICAgICAgIH0sICRjb250YWluZXIpOw0KICAgICAgICB0aGlzLiRwcmV2SXRlbSA9ICgkaXRlbSA9PT0gbnVsbCkgPyB0aGlzLiRwcmV2SXRlbSA6ICRpdGVtOw0KDQogICAgICAgIHNldHRpbmdzLm5leHRJdGVtLm1ldGhvZCA9ICdhcHBlbmQnOw0KICAgICAgICAkaXRlbSA9IE5hdmlnYXRpb25CdWlsZGVyLmNyZWF0ZVByZXZOZXh0SXRlbShzZXR0aW5ncy5uZXh0SXRlbSwgew0KICAgICAgICAgICAgJ2NsYXNzJzogJ25leHQnDQogICAgICAgIH0sICRjb250YWluZXIpOw0KICAgICAgICB0aGlzLiRuZXh0SXRlbSA9ICgkaXRlbSA9PT0gbnVsbCkgPyB0aGlzLiRuZXh0SXRlbSA6ICRpdGVtOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIE5hdmlnYXRpb24gY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlckNvbnRleHQgY2xhc3MgaXMgYmluZGVkIHRvIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICogYW5kIGhvbGRzIGl0cyBwcm9wZXJ0aWVzLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlckNvbnRleHQoKSB7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBGbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIGNoYW5nZWQgKGZvciB1c2VyIHJlcXVlc3QpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jYW5DaGFuZ2VTbGlkZSA9IHRydWU7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEZWZhdWx0IFNsaWRlciBzZXR0aW5nIG9iamVjdCAoQHNlZSBTbGlkZXIpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5kZWZhdWx0cyA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBOYXZpZ2F0aW9uIG9iamVjdCAoQHNlZSBOYXZpZ2F0aW9uKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBTbGlkZXIgb2JqZWN0LCB3aGljaCB0aGlzIGNvbnRleHQgaXMgYXR0YWNlaGQgdG8uDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5vd25lciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBGbGFnLCB3aGljaCBkZXRlcm1pbmVzIGlmIGNoYW5nZSBvZiBhIHNsaWRlIGNhbiBvciBjYW4gbm90IGJlIHNjaGVkdWxlZA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMucHJldmVudFNjaGVkdWxpbmcgPSBmYWxzZTsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFNsaWRlciBzZXR0aW5nIG9iamVjdA0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogSW5zdGFuY2Ugb2YgVGltZXIgY2xhc3MgKEBzZWUgVGltZXIpLCB3aGljaCBpcyB1c2VkIHRvIHN0b3JlIGhvdyBtdWNoDQogICAgICAgICAqIHRpbWUgaXMgbGVmdCB0byBjaGFuZ2UgdGhlIHNsaWRlDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5zbGlkZVRpbWVyID0gbmV3IFRpbWVyKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBUaW1lSW5kaWNhdG9yIGNsYXNzIChAc2VlIFRpbWVJbmRpY2F0b3IpDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lSW5kaWNhdG9yID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRpbWVycyBhcnJheS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnRpbWVycyA9IFtdOw0KICAgICAgICAvKioNCiAgICAgICAgICogTGFzdCB0aW1lb3V0IGlkZW50aWZpZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50aW1lb3V0SWQgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogVHJhbnNpdGlvbiAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24pIHVzZWQgd2hpbGUgY2hhbmdpbmcgc2xpZGVzDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy50cmFuc2l0aW9uID0gbnVsbDsNCiAgICAgICAgLyoqDQogICAgICAgICAqIFRyYW5zaXRpb24gc2V0dGluZ3Mgb2JqZWN0IChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIFNsaWRlckNvbnRleHQNCiAgICAgICAgICovDQogICAgICAgIHRoaXMudHJhbnNpdGlvblNldHRpbmdzID0gbmV3IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvblNldHRpbmdzKCk7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBqUXVlcnkgb2JqZWN0IHdoaWNoIGNvbnRhaW5zIGFsbCBzbGlkZXMNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRzbGlkZXMgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogalF1ZXJ5IG9iamVjdCBjb250YWluaW5nIGVsZW1lbnQgdGhhdCB3cmFwcHMgc2xpZGVzDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy4kd3JhcHBlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kLCB3aGljaCBzaG91bGQgY2hhbmdlIGN1cnJlbnQgc2xpZGUNCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBTbGlkZXJDb250ZXh0DQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmNoYW5nZUN1cnJlbnRTbGlkZSA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBSZWZlcmVuY2UgdG8gbWV0aG9kLCB3aGljaCBzaG91bGQgcmV0dXJuIGpRdWVyeSBvYmplY3Qgd2l0aCBjdXJyZW50IHNsaWRlDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgU2xpZGVyQ29udGV4dA0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5nZXRDdXJyZW50U2xpZGUgPSBudWxsOw0KDQogICAgICAgIHRoaXMudGltZXJzLnB1c2godGhpcy5zbGlkZVRpbWVyKTsNCiAgICB9DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlckNvbnRleHQgY2xhc3MNCiAgICAgKi8NCg0KICAgIC8qKg0KICAgICAqIFNsaWRlciBjbGFzcyBtYW5hZ2VzIGNoYW5naW5nIG9mIHNsaWRlcy4NCiAgICAgKg0KICAgICAqIE9wdGlvbnMgb2JqZWN0Og0KICAgICAqIHsNCiAgICAgKiAgICAgJ25hdmlnYXRpb24nOiBPYmplY3QgdmFsdWUsIC8vbmF2aWdhdGlvbiBzZXR0aW5ncyBvYmplY3QNCiAgICAgKiAgICAgJ3RpbWVvdXQnOiBOdW1iZXIgdmFsdWUsIC8vdGltZSBiZXR3ZWVuIHNsaWRlcyBjaGFuZ2luZw0KICAgICAqICAgICAndHJhbnNpdGlvbic6IFN0cmluZyB2YWx1ZSwgLy9uYW1lIG9mIHRyYW5zaXRpb24gY2xhc3MgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uKQ0KICAgICAqICAgICAnaXNQYXVzZUVuYWJsZWQnOiBCb29sZWFuIHZhbHVlLCAvL2ZsYWcsIHdoaWNoIGRldGVybWluZXMgaWYgcGF1c2UgZmVhdHVyZSBpcyBlbmFibGVkDQogICAgICogICAgICd0aW1lSW5kaWNhdG9yJzogew0KICAgICAqICAgICAgICAgJ2lzRW5hYmxlZCc6IEJvb2xlYW4gdmFsdWUsIC8vZmxhZywgd2hpY2ggZGV0ZXJtaW5lcyBpZiB0aW1lIGluZGljYXRvciBpcyBlbmFibGVkDQogICAgICogICAgICAgICAnc2VsZWN0b3InOiBTdHJpbmcgdmFsdWUsIC8vc2VsZWN0b3Igb2YgdGltZSBpbmRpY2F0b3IgaHRtbCBlbGVtZW50DQogICAgICogICAgICAgICAndmlldyc6IFN0cmluZyB2YWx1ZSwgLy9uYW1lIG9mIHZpZXcgY2xhc3MgKEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICogICAgICAgICAnb3B0aW9ucyc6IE9iamVjdCB2YWx1ZSAvL29iamVjdCB3aXRoIG9wdGlvbnMsIHdoaWNoIHdpbGwgYmUgcGFzc2VkIHRvIGEgdGltZSBpbmRpY2F0b3Igdmlldw0KICAgICAqICAgICB9DQogICAgICogfQ0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSAkICAgICB0aGUgalF1ZXJ5IG9iamVjdA0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBpbnN0YW5jZSBvZiBTbGlkZXJDb250ZXh0IGNsYXNzOyBtdXN0IGJlIHNlcGFyYXRlIGZvciBlYWNoIGluc3RhbmNlIChAc2VlIFNsaWRlckNvbnRleHQpDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgU2xpZGVyIG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gU2xpZGVyKCQsIGNvbnRleHQsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyIGRlZmF1bHRzID0gew0KICAgICAgICAgICAgJ25hdmlnYXRpb24nOiB7fSwNCiAgICAgICAgICAgICd0aW1lb3V0JzogMTAwMDAsDQogICAgICAgICAgICAndHJhbnNpdGlvbic6ICdCYXNpY1RyYW5zaXRpb24nLA0KICAgICAgICAgICAgJ2lzUGF1c2VFbmFibGVkJzogdHJ1ZSwNCiAgICAgICAgICAgICd0aW1lSW5kaWNhdG9yJzogew0KICAgICAgICAgICAgICAgICdpc0VuYWJsZWQnOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAgICAgICAgICAgICd2aWV3JzogJ1ZpZXcnLA0KICAgICAgICAgICAgICAgICdvcHRpb25zJzoge30NCiAgICAgICAgICAgIH0NCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogSW5zdGFuY2Ugb2YgU2xpZGVyQ29udGV4dCBjbGFzcyAoQHNlZSBTbGlkZXJDb250ZXh0KQ0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIE5hdmlnYXRpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY29udGV4dCA9IGNvbnRleHQ7DQoNCiAgICAgICAgY29udGV4dC5vd25lciA9IHRoaXM7DQogICAgICAgIGNvbnRleHQuZGVmYXVsdHMgPSBkZWZhdWx0czsNCiAgICAgICAgY29udGV4dC5zZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQogICAgICAgIGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLiRzbGlkZXMgPSBjb250ZXh0LiRzbGlkZXM7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogRXhlY3V0ZXMgbWV0aG9kIHdpdGggZ2l2ZW4gbWV0aG9kTmFtZSBvbiBlYWNoIFRpbWVyIGluIGNvbnRleHQudGltZXJzIChAc2VlIFRpbWVyKQ0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gbWV0aG9kTmFtZSAgIG5hbWUgb2YgYSBtZXRob2QsIHdoaWNoIHdpbGwgYmUgZXhlY3V0ZWQgb24gdGltZXJzDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUuZXhlY3V0ZU9uVGltZXJzID0gZnVuY3Rpb24obWV0aG9kTmFtZSwgY29udGV4dCkgew0KICAgICAgICB2YXIgaSA9IG51bGwsDQogICAgICAgICAgICB0aW1lciA9IG51bGwsDQogICAgICAgICAgICB0aW1lcnMgPSBjb250ZXh0LnRpbWVyczsNCg0KICAgICAgICBmb3IgKGkgPSAwOyBpIDwgdGltZXJzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB0aW1lciA9IHRpbWVyc1tpXTsNCiAgICAgICAgICAgIGlmICh0eXBlb2YodGltZXJbbWV0aG9kTmFtZV0pID09PSAnZnVuY3Rpb24nKSB7DQogICAgICAgICAgICAgICAgdGltZXJbbWV0aG9kTmFtZV0oKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBEZXNjaGVkdWxlcyBjaGFuZ2Ugb2YgYSBzbGlkZSwgYnkgY2xlYXJpbmcgdGltZW91dCBwcmV2aW91c2x5IHNldCBieSBzZXRUaWVtb3V0KCkgZnVuY3Rpb24uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLmRlc2NoZWR1bGVTbGlkZSA9IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgaWYgKGNvbnRleHQudGltZW91dElkICE9PSBudWxsKSB7DQogICAgICAgICAgICBjbGVhclRpbWVvdXQoY29udGV4dC50aW1lb3V0SWQpOw0KICAgICAgICAgICAgY29udGV4dC50aW1lb3V0SWQgPSBudWxsOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFNjaGVkdWxlcyBjaGFuZ2Ugb2YgYSBzbGlkZSwgYnkgc2V0dGluZyB0aW1lb3V0ICh1c2luZyBzZXRUaWVtb3V0KCkgZnVuY3Rpb24pIGlmIGNhbi4NCiAgICAgKiBJZiBjYW4ndCwgdHJpZXMgYWdhaW4gYWZ0ZXIgc2hvcnQgcGVyaW9kIG9mIHRpbWUuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgICBjdXJyZW50IGNvbnRleHQNCiAgICAgKi8NCiAgICBTbGlkZXIucHJvdG90eXBlLnNjaGVkdWxlU2xpZGUgPSBmdW5jdGlvbihjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgb3duZXIuZGVzY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KDQogICAgICAgIGlmICghY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZyAmJiBjb250ZXh0LiRzbGlkZXMuc2l6ZSgpID4gMSkgew0KICAgICAgICAgICAgb3duZXIuZXhlY3V0ZU9uVGltZXJzKCdzZXQnLCBjb250ZXh0KTsNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC50aW1lSW5kaWNhdG9yICE9PSBudWxsKSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvci5wbGF5KCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuY2hhbmdlQ3VycmVudFNsaWRlQnkoMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSwgY29udGV4dC5zZXR0aW5ncy50aW1lb3V0IC0gY29udGV4dC5zbGlkZVRpbWVyLmVsYXBzZWQpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0sIDEwMCk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQ2hhbmdlcyBjdXJyZW50IHNsaWRlLCBieSBvZmZzZXQgcGVyZm9ybWluZyBjb250ZXh0LnRyYW5zaXRpb24NCiAgICAgKiBBbnkgb2Zmc2V0IHZhbHVlIGlzIHNhdmUgKGlmIGl0IGlzIGFuIGludGVnZXIpLg0KICAgICAqDQogICAgICogQG1lbWJlciBTbGlkZXINCiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0ICAgIHRoZSBvZmZzZXQgdG8gYW4gaW5kZXggb2YgYSBuZXcgc2xpZGUNCiAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICAgY3VycmVudCBjb250ZXh0DQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5jaGFuZ2VDdXJyZW50U2xpZGVCeSA9IGZ1bmN0aW9uKG9mZnNldCwgY29udGV4dCkgew0KICAgICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnRyYW5zaXRpb25TZXR0aW5ncywNCiAgICAgICAgICAgICRjdXJyZW50U2xpZGUgPSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLA0KICAgICAgICAgICAgJHNsaWRlcyA9IGNvbnRleHQuJHNsaWRlczsNCg0KICAgICAgICBpZiAoKG9mZnNldCAlICRzbGlkZXMuc2l6ZSgpKSAhPT0gMCkgew0KICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IGZhbHNlOw0KDQogICAgICAgICAgICBzZXR0aW5ncy5vZmZzZXQgPSBvZmZzZXQ7DQogICAgICAgICAgICBzZXR0aW5ncy4kY3VycmVudFNsaWRlID0gJGN1cnJlbnRTbGlkZTsNCiAgICAgICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUgPSAkc2xpZGVzLmVxKCgkY3VycmVudFNsaWRlLmluZGV4KCkgKyBvZmZzZXQpICUgJHNsaWRlcy5zaXplKCkpOw0KDQogICAgICAgICAgICBjb250ZXh0LmNoYW5nZUN1cnJlbnRTbGlkZShzZXR0aW5ncy4kbmV4dFNsaWRlKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5wZXJmb3JtKGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgICAgIGNvbnRleHQub3duZXIuZXhlY3V0ZU9uVGltZXJzKCdyZXNldCcsIGNvbnRleHQpOw0KICAgICAgICB9DQoNCg0KICAgICAgICB2YXIgJGNhcm91c2VsID0gJChjb250ZXh0LiR3cmFwcGVyKS5wYXJlbnRzKCIuY2Fyb3VzZWwiKTsNCiAgICAgICAgJGNhcm91c2VsLnRyaWdnZXIoInNsaWRlLWNoYW5nZWQiKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU3RhcnRzIGF1dG9tYXRpYyBzbGlkZXMgY2hhbmdpbmcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgdGhpcy5jb250ZXh0KTsNCiAgICAgICAgdGhpcy5zY2hlZHVsZVNsaWRlKHRoaXMuY29udGV4dCk7DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIENhbmNlbCB0aGUgZGVmYXVsdCBhY3Rpb24gb2YgZXZlbnQgYW5kIGNoYW5nZXMgc2xpZGUgbWFudWFsbHkuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFNsaWRlcg0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBldmVudCAgICAgdGhlIGV2ZW50DQogICAgICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldCAgICB0aGUgb2Zmc2V0IHRvIGFuIGluZGV4IG9mIGEgbmV3IHNsaWRlDQogICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgIGN1cnJlbnQgY29udGV4dA0KICAgICAqLw0KICAgIFNsaWRlci5wcm90b3R5cGUub25DaGFuZ2VDdXJyZW50U2xpZGUgPSBmdW5jdGlvbihldmVudCwgb2Zmc2V0LCBjb250ZXh0KSB7DQogICAgICAgIHZhciBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsNCiAgICAgICAgaWYgKGNvbnRleHQuY2FuQ2hhbmdlU2xpZGUpIHsNCiAgICAgICAgICAgIG93bmVyLmRlc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgIG93bmVyLmNoYW5nZUN1cnJlbnRTbGlkZUJ5KG9mZnNldCwgY29udGV4dCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogU2VsZWN0cyBuYXZpZ2F0aW9uIGl0ZW0gd2l0aCBnaXZlbiBpbmRleC4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgU2xpZGVyDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IGluZGV4ICAgICB0aGUgaW5kZXggb2YgbmF2aWdhdGlvbiBpdGVtDQogICAgICovDQogICAgU2xpZGVyLnByb3RvdHlwZS5zZWxlY3ROYXZpZ2F0aW9uSXRlbSA9IGZ1bmN0aW9uKGluZGV4KSB7DQogICAgICAgIHRoaXMuY29udGV4dC5uYXZpZ2F0aW9uLnNlbGVjdEl0ZW0oaW5kZXgpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlciBjbGFzcw0KICAgICAqLw0KDQogICAgLyoqDQogICAgICogU2xpZGVySW5pdGlhbGl6ZXIgb2JqZWN0IHNldCB1cCBpbnN0YW5jZXMgb2YgU2xpZGVyIGNsYXNzDQogICAgICovDQogICAgU2xpZGVySW5pdGlhbGl6ZXIgPSAoZnVuY3Rpb24oJCkgew0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgZXZlbnRzIHRvIG5hdmlnYXRpb24gaXRlbXMuDQogICAgICAgICAqDQogICAgICAgICAqIEBwYXJhbSB7U2xpZGVyQ29udGV4dH0gY29udGV4dCAgIGEgY29udGV4dCBvZiBhIFNsaWRlciBjbGFzcyBpbnN0YW5jZQ0KICAgICAgICAgKi8NCiAgICAgICAgZnVuY3Rpb24gYXR0YWNoTmF2aWdhdGlvbkV2ZW50cyhjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgb3duZXIgPSBjb250ZXh0Lm93bmVyLA0KICAgICAgICAgICAgICAgICRuYXZMaW5rcyA9IGNvbnRleHQuJHdyYXBwZXIuZmluZCgiLm5hdiBhIiksDQogICAgICAgICAgICAgICAgJHByZXZJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcucHJldi10ZXh0JyksDQogICAgICAgICAgICAgICAgJG5leHRJdGVtVHh0ID0gY29udGV4dC4kd3JhcHBlci5maW5kKCcubmV4dC10ZXh0Jyk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kaXRlbXMuZWFjaChmdW5jdGlvbihpbmRleCkgew0KICAgICAgICAgICAgICAgIHZhciAkc2xpZGUgPSBjb250ZXh0LiRzbGlkZXMuZXEoaW5kZXgpOw0KDQogICAgICAgICAgICAgICAgJCh0aGlzKS5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgJHNsaWRlLmluZGV4KCkgLSBjb250ZXh0LmdldEN1cnJlbnRTbGlkZSgpLmluZGV4KCksIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRwcmV2SXRlbVR4dC5jbGljayhmdW5jdGlvbihldmVudCkgew0KICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAtMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5leHRJdGVtVHh0LmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7DQogICAgICAgICAgICAgICAgb3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZXZlbnQsIDEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kcHJldkl0ZW0uY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgLTEsIGNvbnRleHQpOw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgIGNvbnRleHQubmF2aWdhdGlvbi4kbmV4dEl0ZW0uY2xpY2soZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgJG5hdkxpbmtzLm9uKCJrZXlkb3duIiwgZnVuY3Rpb24oZXZlbnQpIHsNCiAgICAgICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHsNCiAgICAgICAgICAgICAgICAgICAgY2FzZSAzNzoNCiAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyLm9uQ2hhbmdlQ3VycmVudFNsaWRlKGV2ZW50LCAtMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgIGNhc2UgMzk6DQogICAgICAgICAgICAgICAgICAgICAgICBvd25lci5vbkNoYW5nZUN1cnJlbnRTbGlkZShldmVudCwgMSwgY29udGV4dCk7DQogICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoIi5hY3RpdmUiKS5mb2N1cygpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfSk7DQogICAgICAgIH0NCg0KICAgICAgICAvKioNCiAgICAgICAgICogQXR0YWNoZXMgcGF1c2UgZXZlbnQgdG8gbmF2aWdhdGlvbiB3cmFwcGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGF0dGFjaFBhdXNlRXZlbnQoY29udGV4dCkgew0KICAgICAgICAgICAgdmFyIG93bmVyID0gY29udGV4dC5vd25lciwNCiAgICAgICAgICAgICAgICAkZWxlbWVudCA9IGNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICAgICAgJG5hdkxpbmtzID0gJGVsZW1lbnQuZmluZCgiLm5hdiBhIik7DQoNCiAgICAgICAgICAgIHZhciBjYWxsYmFja01vdXNlZW50ZXIgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBjb250ZXh0LnByZXZlbnRTY2hlZHVsaW5nID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBvd25lci5kZXNjaGVkdWxlU2xpZGUoY29udGV4dCk7DQoNCiAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3VwZGF0ZScsIGNvbnRleHQpOw0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnRpbWVJbmRpY2F0b3IgIT09IG51bGwpIHsNCiAgICAgICAgICAgICAgICAgICAgY29udGV4dC50aW1lSW5kaWNhdG9yLnBhdXNlKCk7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZWxlbWVudC5tb3VzZWVudGVyKGNhbGxiYWNrTW91c2VlbnRlcik7DQogICAgICAgICAgICAkbmF2TGlua3Mub24oImZvY3VzIiwgY2FsbGJhY2tNb3VzZWVudGVyKTsNCg0KICAgICAgICAgICAgdmFyIGNhbGxiYWNrTW91c2VMZWF2ZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgICAgIGNvbnRleHQucHJldmVudFNjaGVkdWxpbmcgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICBvd25lci5zY2hlZHVsZVNsaWRlKGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAkZWxlbWVudC5tb3VzZWxlYXZlKGNhbGxiYWNrTW91c2VMZWF2ZSk7DQogICAgICAgICAgICAkbmF2TGlua3Mub24oImJsdXIiLCBjYWxsYmFja01vdXNlTGVhdmUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENyZWF0ZXMgdGltZSBpbmRpY2F0b3Igdmlldw0KICAgICAgICAgKg0KICAgICAgICAgKiBAcGFyYW0ge1NsaWRlckNvbnRleHR9IGNvbnRleHQgICBhIGNvbnRleHQgb2YgYSBTbGlkZXIgY2xhc3MgaW5zdGFuY2UNCiAgICAgICAgICovDQogICAgICAgIGZ1bmN0aW9uIGNyZWF0ZUluZGljYXRvcihjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgc2V0dGluZ3MgPSBjb250ZXh0LnNldHRpbmdzLA0KICAgICAgICAgICAgICAgIHRpbWVJbmRpY2F0b3IgPSBudWxsLA0KICAgICAgICAgICAgICAgIFZpZXdDb25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3Nbc2V0dGluZ3MudGltZUluZGljYXRvci52aWV3XSwNCiAgICAgICAgICAgICAgICB2aWV3ID0gbnVsbDsNCg0KICAgICAgICAgICAgaWYgKFZpZXdDb25zdHJ1Y3RvciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgICAgIHZpZXcgPSBuZXcgVmlld0NvbnN0cnVjdG9yKHNldHRpbmdzLnRpbWVJbmRpY2F0b3Iuc2VsZWN0b3IsIHNldHRpbmdzLnRpbWVJbmRpY2F0b3Iub3B0aW9ucyk7DQogICAgICAgICAgICAgICAgdGltZUluZGljYXRvciA9IG5ldyBUaW1lSW5kaWNhdG9yKCQsIHZpZXcsIHNldHRpbmdzLnRpbWVvdXQpOw0KICAgICAgICAgICAgICAgIGNvbnRleHQudGltZUluZGljYXRvciA9IHRpbWVJbmRpY2F0b3I7DQogICAgICAgICAgICAgICAgY29udGV4dC50aW1lcnMucHVzaCh0aW1lSW5kaWNhdG9yKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBBdHRhY2hlcyBldmVudHMgdG8gbmF2aWdhdGlvbi4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplTmF2aWdhdGlvbihjb250ZXh0KSB7DQogICAgICAgICAgICBjb250ZXh0LnNldHRpbmdzLm5hdmlnYXRpb24uc2xpZGVzQ291bnQgPSBjb250ZXh0LiRzbGlkZXMubGVuZ3RoOw0KICAgICAgICAgICAgY29udGV4dC5uYXZpZ2F0aW9uID0gbmV3IE5hdmlnYXRpb24oJCwgY29udGV4dC4kd3JhcHBlciwgY29udGV4dC5zZXR0aW5ncy5uYXZpZ2F0aW9uKTsNCg0KICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICBhdHRhY2hOYXZpZ2F0aW9uRXZlbnRzKGNvbnRleHQpOw0KICAgICAgICAgICAgfSwgMTAwMCk7DQoNCg0KICAgICAgICAgICAgaWYgKGNvbnRleHQuc2V0dGluZ3MuaXNQYXVzZUVuYWJsZWQpIHsNCiAgICAgICAgICAgICAgICBhdHRhY2hQYXVzZUV2ZW50KGNvbnRleHQpOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIEluaXRpYWxpemVzIHRyYW5zaXRpb24gZm9yIGEgZ2l2ZW4gY29udGV4dC4NCiAgICAgICAgICoNCiAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAqLw0KICAgICAgICBmdW5jdGlvbiBpbml0aWFsaXplVHJhbnNpdGlvbihjb250ZXh0KSB7DQogICAgICAgICAgICB2YXIgVHJhbnNpdGlvbkNvbnN0cnVjdG9yID0gbnVsbCwNCiAgICAgICAgICAgICAgICBvd25lciA9IGNvbnRleHQub3duZXI7DQoNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzLmNhbGxiYWNrID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5jYW5DaGFuZ2VTbGlkZSA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICBpZiAoY29udGV4dC5wcmV2ZW50U2NoZWR1bGluZykgew0KICAgICAgICAgICAgICAgICAgICBvd25lci5leGVjdXRlT25UaW1lcnMoJ3Jlc2V0JywgY29udGV4dCk7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgb3duZXIuc2NoZWR1bGVTbGlkZShjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICBUcmFuc2l0aW9uQ29uc3RydWN0b3IgPSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zW2NvbnRleHQuc2V0dGluZ3MudHJhbnNpdGlvbl07DQogICAgICAgICAgICBpZiAoKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gbnVsbCkgfHwgKFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9PT0gdW5kZWZpbmVkKSkgew0KICAgICAgICAgICAgICAgIFRyYW5zaXRpb25Db25zdHJ1Y3RvciA9IFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnNbY29udGV4dC5kZWZhdWx0cy50cmFuc2l0aW9uXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbiA9IG5ldyBUcmFuc2l0aW9uQ29uc3RydWN0b3IoKTsNCiAgICAgICAgICAgIGNvbnRleHQudHJhbnNpdGlvbi5pbml0KGNvbnRleHQudHJhbnNpdGlvblNldHRpbmdzKTsNCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAvKioNCiAgICAgICAgICAgICAqIEluaXRpYWxpemVzIFNsaWRlciBvYmplY3Qgd2l0aCBhIGdpdmVuIGNvbnRleHQuDQogICAgICAgICAgICAgKg0KICAgICAgICAgICAgICogQHBhcmFtIHtTbGlkZXJDb250ZXh0fSBjb250ZXh0ICAgYSBjb250ZXh0IG9mIGEgU2xpZGVyIGNsYXNzIGluc3RhbmNlDQogICAgICAgICAgICAgKi8NCiAgICAgICAgICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKGNvbnRleHQpIHsNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplTmF2aWdhdGlvbihjb250ZXh0KTsNCiAgICAgICAgICAgICAgICBpbml0aWFsaXplVHJhbnNpdGlvbihjb250ZXh0KTsNCg0KICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LnNldHRpbmdzLnRpbWVJbmRpY2F0b3IuaXNFbmFibGVkKSB7DQogICAgICAgICAgICAgICAgICAgIGNyZWF0ZUluZGljYXRvcihjb250ZXh0KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH07DQogICAgfSgkKSk7DQogICAgLyoqDQogICAgICogZW5kIG9mIFNsaWRlckluaXRpYWxpemVyDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBDYXJvdXNlbCBjbGFzcyBkaXNwbGF5cyBvbmUgc2xpZGUgKHNvbWUgY29udGVudCkgYXQgdGhlIHRpbWUuDQogICAgICogSXRzIGJlaGF2aW91ciBkZXBlbmRzIG9uIHNldHRpbmdzIChwYXNzZWQgdG8gaW5pdCgpIG1ldGhvZCkuDQogICAgICogRm9yIG1vcmUgZGV0YWlscyBAc2VlIFNsaWRlciwgQHNlZSBTbGlkZXJJbml0aWFsaXplciwgQHNlZSBOYXZpZ2F0aW9uLA0KICAgICAqIEBzZWUgTmF2aWdhdGlvbkJ1aWxkZXIsIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uLA0KICAgICAqIEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3DQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBDYXJvdXNlbCgpIHsNCiAgICAgICAgdmFyIGNvbnRleHQgPSB0aGlzOw0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBJbnN0YW5jZSBvZiBhIFNsaWRlciBjbGFzcyAoQHNlZSBTbGlkZXIpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNsaWRlciA9IG51bGw7DQogICAgICAgIC8qKg0KICAgICAgICAgKiBEaXNwbGF5ZWQgc2xpZGUgKGpRdWVyeSBvYmplY3QpLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLiRjdXJyZW50U2xpZGUgPSBudWxsOw0KICAgICAgICAvKioNCiAgICAgICAgICogQWxsIHNsaWRlcyAoalF1ZXJ5IG9iamVjdCkuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuJHNsaWRlcyA9IG51bGw7DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIENoYW5nZXMgY3VycmVudCBzbGlkZSB0byBhICRuZXdTbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gJG5ld1NsaWRlICB0aGUgbmV3IHNsaWRlIChqUXVlcnkpIG9iamVjdC4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlID0gZnVuY3Rpb24oJG5ld1NsaWRlKSB7DQogICAgICAgICAgICBjb250ZXh0LiRjdXJyZW50U2xpZGUgPSAkbmV3U2xpZGU7DQogICAgICAgICAgICBjb250ZXh0LnNsaWRlci5zZWxlY3ROYXZpZ2F0aW9uSXRlbSgkbmV3U2xpZGUuaW5kZXgoKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFJldHVybnMgY3VycmVudCBzbGlkZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG1lbWJlciBDYXJvdXNlbA0KICAgICAgICAgKiBAcmV0dXJuIGN1cnJlbnQgc2xpZGUgKGpRdWVyeSkgb2JqZWN0Lg0KICAgICAgICAgKiBAdHlwZSBPYmplY3QNCiAgICAgICAgICovDQogICAgICAgIHRoaXMuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC4kY3VycmVudFNsaWRlOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuZGF0YSA9IHt9Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFJlc2V0cyB0aGUgY2Fyb3VzZWwuDQogICAgICoNCiAgICAgKiBAbWVtYmVyIENhcm91c2VsDQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMuJHNsaWRlcy5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIHRoaXMuY2hhbmdlQ3VycmVudFNsaWRlKHRoaXMuJHNsaWRlcy5maXJzdCgpKTsNCiAgICAgICAgdGhpcy4kY3VycmVudFNsaWRlLnNob3coKTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogSW5pdGlhbGl6ZXMgdGhlIGNhcm91c2VsLg0KICAgICAqIFdyYXBwcyBjYXJvdXNlbCBjb250ZW50IHdpdGggPGRpdiBjbGFzcz0id3JhcHBlciIgLz4gZWxlbWVudCwNCiAgICAgKiBzZWxlY3RzIHNsaWRlcyAoPGxpIC8+IGVsZW1lbnRzKSBmcm9tIDx1bCBjbGFzcz0ic2xpZGVzIiAvPiBlbGVtZW50LA0KICAgICAqIGluaXRpYWxpemVzIFNsaWRlciBjbGFzcyBpbmN0YW5jZSwgcmVzZXRzIHRoZSBjYXJvdXNlbCBhbmQgc3RhcnQgYXV0b21hdGljIHNsaWRlcyBjaGFuZ2luZy4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgQ2Fyb3VzZWwNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gJGNvbnRhaW5lciAgICAgalF1ZXJ5IG9iamVjdCB3aXRoIGEgbWFpbiBodG1sIGVsZW1lbnQgb2YgdGhlIGNhcm91c2VsDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICAgIGNhcm91c2VsIG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbigkY29udGFpbmVyLCBvcHRpb25zKSB7DQogICAgICAgIHZhciAkd3JhcHBlciA9ICQoJzxkaXYvPicsIHsNCiAgICAgICAgICAgICAgICAnY2xhc3MnOiAnd3JhcHBlcicNCiAgICAgICAgICAgIH0pLA0KICAgICAgICAgICAgc2xpZGVyQ29udGV4dCA9IG51bGw7DQoNCiAgICAgICAgJHdyYXBwZXIuYXBwZW5kKCRjb250YWluZXIuY2hpbGRyZW4oKS5kZXRhY2goKSk7DQogICAgICAgICRjb250YWluZXIuYXBwZW5kKCR3cmFwcGVyKTsNCiAgICAgICAgdGhpcy4kc2xpZGVzID0gJGNvbnRhaW5lci5maW5kKCcuc2xpZGVzIGxpLnNsaWRlJyk7DQoNCiAgICAgICAgc2xpZGVyQ29udGV4dCA9IG5ldyBTbGlkZXJDb250ZXh0KCk7DQogICAgICAgIHNsaWRlckNvbnRleHQuY2hhbmdlQ3VycmVudFNsaWRlID0gdGhpcy5jaGFuZ2VDdXJyZW50U2xpZGU7DQogICAgICAgIHNsaWRlckNvbnRleHQuZ2V0Q3VycmVudFNsaWRlID0gdGhpcy5nZXRDdXJyZW50U2xpZGU7DQogICAgICAgIHNsaWRlckNvbnRleHQuJHNsaWRlcyA9IHRoaXMuJHNsaWRlczsNCiAgICAgICAgc2xpZGVyQ29udGV4dC4kd3JhcHBlciA9ICR3cmFwcGVyOw0KDQogICAgICAgIHRoaXMuc2xpZGVyID0gbmV3IFNsaWRlcigkLCBzbGlkZXJDb250ZXh0LCBvcHRpb25zKTsNCiAgICAgICAgU2xpZGVySW5pdGlhbGl6ZXIuaW5pdGlhbGl6ZShzbGlkZXJDb250ZXh0KTsNCg0KICAgICAgICB0aGlzLnJlc2V0KCk7DQogICAgICAgIHRoaXMuc2xpZGVyLnJ1bigpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIENhcm91c2VsIGNsYXNzDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBSZWdpc3RlcnMgZWFjaCBlbGVtZW50cyB0aGF0IG1hdGNoIHRoZSBwcm92aWRlZCBzZWxlY3RvciBhcyBhIGNhcm91c2VsIHdpdGggYSBnaXZlbiBvcHRpb25zLg0KICAgICAqIENhcm91c2VsIG9wdGlvbnMgb2JqZWN0IDoNCiAgICAgKiB7DQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIG5hdmlnYXRpb246IE9iamVjdA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyBUaGUgbmF2aWdhdGlvbiBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgJ25hdmlnYXRpb24nOiB7DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy9pc0VuYWJsZWQ6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIG5hdmlnYXRpb24gaXMgZW5hYmxlZC4NCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAnaXNFbmFibGVkJzogdHJ1ZSwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBoYXNQcmV2TmV4dEl0ZW1zOiBCb29sZWFuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBuYXZpZ2F0aW9uIGhhcyBwcmV2aW91cyBhbmQgbmV4dCBidXR0b25zLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdoYXNQcmV2TmV4dEl0ZW1zJzogdHJ1ZSwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBpdGVtOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYXZpZ2F0aW9uIGl0ZW0gY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ2l0ZW0nOiB7DQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBsYWJlbDogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBMYWJlbCB0ZW1wbGF0ZTsgZWFjaCAnI3tpbmRleH0nIHN0cmluZyB3aWxsIGJlIHJlcGxhY2VkIGJ5IHRoZSBudW1iZXIgb2YgYSBzbGlkZS4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdsYWJlbCc6ICcje2luZGV4fScsDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBzZWxlY3RvcjogU3RyaW5nDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBOYXZpZ2F0aW9uIGl0ZW1zIGNvbnRhaW5lciBzZWxlY3RvcjsgaWYgZXF1YWxzIG51bGwsIHRoZSBjb250YWluZXIgd2lsbCBiZSBnZW5lcmF0ZWQNCiAgICAgKiAgICAgICAgICAgICAvLyAoJ2RpdicgZWxlbWVudCB3aXRoICduYXYnIGNsYXNzIGF0dHJpYnV0ZSBpbnNpZGUgdGhlIGNhcm91c2VsKS4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdzZWxlY3Rvcic6IG51bGwNCiAgICAgKiAgICAgICAgfSwNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBwcmV2SXRlbTogT2JqZWN0DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gTmF2aWdhdGlvbiAncHJldmlvdXMgaXRlbScgY29uZmlndXJhdGlvbiBvYmplY3QuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ3ByZXZJdGVtJzogew0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gbGFiZWw6IFN0cmluZw0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gVGhlICdwcmV2aW91cyBpdGVtJyBsYWJlbC4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdsYWJlbCc6ICc8JywNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIHNlbGVjdG9yOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIE5hdmlnYXRpb24gJ3ByZXZpb3VzIGl0ZW0nIHNlbGVjdG9yOyBpZiBlcXVhbHMgbnVsbCwgdGhlIGl0ZW0gd2lsbCBiZSBnZW5lcmF0ZWQNCiAgICAgKiAgICAgICAgICAgICAvLyAoJ2EnIGVsZW1lbnQgd2l0aCAncHJldicgY2xhc3MgYXR0cmlidXRlIGluc2lkZSB0aGUgbmF2aWdhdGlvbiBjb250YWluZXIpLg0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgJ3NlbGVjdG9yJzogbnVsbCwNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGlzQ29udGFpbmVyOiBCb29sZWFuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAvLyBTZXRzIHdoZXRoZXIgdGhlIGVsZW1lbnQgZm91bmQgYnkgc2VsZWN0b3Igc2hvdWxkIGJlIHRyZWF0ZWQgYXMgYSBjb250YWluZXIgKGlmIHRydWUpDQogICAgICogICAgICAgICAgICAgLy8gb3Igc2hvdWxkIGJlIGFkb3B0ZWQgYXMgYSAncHJldmlvdXMgaXRlbScgKGlmIGZhbHNlKS4gSWYgc2VsZWN0b3IgZXF1YWxzIG51bGwgdGhpcyBwcm9wZXJ0eSBpcyBtZWFuaW5nbGVzcy4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdpc0NvbnRhaW5lcic6IGZhbHNlDQogICAgICogICAgICAgICB9LA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIG5leHRJdGVtOiBPYmplY3QNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyBOYXZpZ2F0aW9uICduZXh0IGl0ZW0nIGNvbmZpZ3VyYXRpb24gb2JqZWN0Lg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICduZXh0SXRlbSc6IHsNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIGxhYmVsOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIFRoZSAnbmV4dCBpdGVtJyBsYWJlbC4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgICdsYWJlbCc6ICc+JywNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIHNlbGVjdG9yOiBTdHJpbmcNCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIE5hdmlnYXRpb24gJ25leHQgaXRlbScgc2VsZWN0b3I7IGlmIGVxdWFscyBudWxsLCB0aGUgaXRlbSB3aWxsIGJlIGdlbmVyYXRlZA0KICAgICAqICAgICAgICAgICAgIC8vICgnYScgZWxlbWVudCB3aXRoICduZXh0JyBjbGFzcyBhdHRyaWJ1dGUgaW5zaWRlIHRoZSBuYXZpZ2F0aW9uIGNvbnRhaW5lcikuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnc2VsZWN0b3InOiBudWxsLA0KICAgICAqICAgICAgICAgICAgIC8vDQogICAgICogICAgICAgICAgICAgLy8gaXNDb250YWluZXI6IEJvb2xlYW4NCiAgICAgKiAgICAgICAgICAgICAvLw0KICAgICAqICAgICAgICAgICAgIC8vIFNldHMgd2hldGhlciB0aGUgZWxlbWVudCBmb3VuZCBieSBzZWxlY3RvciBzaG91bGQgYmUgdHJlYXRlZCBhcyBhIGNvbnRhaW5lciAoaWYgdHJ1ZSkNCiAgICAgKiAgICAgICAgICAgICAvLyBvciBzaG91bGQgYmUgYWRvcHRlZCBhcyBhICduZXh0IGl0ZW0nIChpZiBmYWxzZSkuIElmIHNlbGVjdG9yIGVxdWFscyBudWxsIHRoaXMgcHJvcGVydHkgaXMgbWVhbmluZ2xlc3MuDQogICAgICogICAgICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICAgICAnaXNDb250YWluZXInOiBmYWxzZQ0KICAgICAqICAgICAgICAgfQ0KICAgICAqICAgICB9LA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyB0aW1lb3V0OiBOdW1iZXINCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gVGhlIGludGVydmFsIGJldHdlZW4gdGhlIHNsaWRlcyBpbiBtaWxpc2Vjb25kcy4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgJ3RpbWVvdXQnOiAxMDAwMCwNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gdHJhbnNpdGlvbjogU3RyaW5nDQogICAgICogICAgIC8vDQogICAgICogICAgIC8vIE5hbWUgb2YgdGhlIHRyYW5zaXRpb24gY2xhc3MsIHdoaWNoIHdpbGwgYmUgdXNlZC4gUG9zc2libGUgdmFsdWVzIGFyZToNCiAgICAgKiAgICAgLy8gLSBCYXNpY1RyYW5zaXRpb24gLSB3aXRob3V0IGFueSBhbmltYXRpb24sDQogICAgICogICAgIC8vIC0gRmFkZUluVHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBmYWRlcyBpbiwNCiAgICAgKiAgICAgLy8gLSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gLSBuZXcgc2xpZGUgbW92ZXMgZnJvbSByaWdodCAoZnJvbSBsZWZ0IGlmIHVzZXIgc2VsZWN0cyBzbGlkZSB3aXRoIGxvd2VyIGlkIG9yIGNsaWNrcyBvbiAncHJldmlvdXMgaXRlbScpLA0KICAgICAqICAgICAvLyAtIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gLSBuZXcgc2xpZGUgbW92ZXMgZnJvbSB0b3AgKGZyb20gYm90dG9tIGlmIHVzZXIgc2VsZWN0cyBzbGlkZSB3aXRoIGxvd2VyIGlkIG9yIGNsaWNrcyBvbiAncHJldmlvdXMgaXRlbScpLA0KICAgICAqICAgICAvLyAtIG90aGVyIC0gaWYgaW1wbGVtZW50ZWQgKGRlcml2ZWQgZnJvbSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlRyYW5zaXRpb24gY2xhc3MpIGFuZCBhZGRlZCB0byBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgJ3RyYW5zaXRpb24nOiAnQmFzaWNUcmFuc2l0aW9uJywNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gaXNQYXVzZUVuYWJsZWQ6IEJvb2xlYW4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSBwYXVzZSBmZWF0dXJlIGlzIGVuYWJsZWQuDQogICAgICogICAgIC8vIFBhdXNlIGZlYXR1cmUgcGF1c2VzIGNvdW50ZG93biBvZiBjaGFuZ2luZyBzbGlkZXMsIHdoZW4gbW91c2UgaXMgaW4gYSBjYXJvdXNlbCBhcmVhLg0KICAgICAqICAgICAvLw0KICAgICAqICAgICAnaXNQYXVzZUVuYWJsZWQnOiB0cnVlLA0KICAgICAqICAgICAvLw0KICAgICAqICAgICAvLyB0aW1lSW5kaWNhdG9yOiBPYmplY3QNCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgLy8gJ1RpbWUgaW5kaWNhdG9yJyBjb25maWd1cmF0aW9uIG9iamVjdC4NCiAgICAgKiAgICAgLy8NCiAgICAgKiAgICAgJ3RpbWVJbmRpY2F0b3InOiB7DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gaXNFbmFibGVkOiBCb29sZWFuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gU2V0cyB3aGV0aGVyIHRoZSAndGltZSBpbmRpY2F0b3InIGlzIGVuYWJsZWQuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ2lzRW5hYmxlZCc6IGZhbHNlLA0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgIC8vIHNlbGVjdG9yOiBTdHJpbmcNCiAgICAgKiAgICAgICAgIC8vDQogICAgICogICAgICAgICAvLyAnVGltZSBpbmRpY2F0b3InIHNlbGVjdG9yLg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdzZWxlY3Rvcic6IG51bGwsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gdmlldzogU3RyaW5nDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gTmFtZSBvZiB0aGUgdmlldyBjbGFzcywgd2hpY2ggd2lsbCBiZSB1c2VkLiBQb3NzaWJsZSB2YWx1ZXMgYXJlOg0KICAgICAqICAgICAgICAgLy8gLSBWaWV3IC0gd2l0aG91dCBhbnkgYW5pbWF0aW9uIChiYXNlIGNsYXNzKSwNCiAgICAgKiAgICAgICAgIC8vIC0gUHJvZ3Jlc3NCYXJWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUgYXMgcHJvZ3Jlc3MgYmFyLA0KICAgICAqICAgICAgICAgLy8gLSBSb3RhdG9yVmlldyAtIHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lIHdpdGggdGhlIGZpbGxpbmcgdXAgcmluZw0KICAgICAqICAgICAgICAgLy8gLSBvdGhlciAtIGlmIGltcGxlbWVudGVkIChkZXJpdmVkIGZyb20gWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3IGNsYXNzKSBhbmQgYWRkZWQgdG8gWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cyBtb2R1bGUuDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgJ3ZpZXcnOiAnVmlldycsDQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gb3B0aW9uczogT2JqZWN0DQogICAgICogICAgICAgICAvLw0KICAgICAqICAgICAgICAgLy8gJ1RpbWUgaW5kaWNhdG9yJyB2aWV3IHNldHRpbmdzIG9iamVjdC4gRGVwZW5kcyBvbiB2aWV3Lg0KICAgICAqICAgICAgICAgLy8NCiAgICAgKiAgICAgICAgICdvcHRpb25zJzoge30NCiAgICAgKiAgICAgfQ0KICAgICAqIH0NCiAgICAgKi8NCg0KICAgIC8qIHB1Yi5yZWdpc3RlciA9IGZ1bmN0aW9uIChzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICB2YXIgJGNhcm91c2VscyA9ICQoc2VsZWN0b3IpOw0KICAgICAkY2Fyb3VzZWxzLmVhY2goZnVuY3Rpb24gKCkgew0KICAgICAvL3ZhciBjYXJvdXNlbCA9IG5ldyBDYXJvdXNlbCgkKTsNCiAgICAgY29uc29sZS5sb2coJCh0aGlzKSk7DQogICAgIC8vY2Fyb3VzZWwuaW5pdCgkKHRoaXMpLCBvcHRpb25zKTsNCiAgICAgfSk7DQogICAgIH07Ki8NCg0KICAgIC8qIENhcm91c2VsIHRvdWNoIHN1cHBvcnQgKi8NCiAgICBDYXJvdXNlbC5wcm90b3R5cGUuc3dpcGVTbGlkZSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc2VsZiA9IHRoaXMsDQogICAgICAgICAgICAkd3JhcHBlciA9IHRoaXMuc2xpZGVyLmNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICBoYW1tZXIgPSBuZXcgSGFtbWVyKCR3cmFwcGVyWzBdKTsNCg0KICAgICAgICBoYW1tZXIub24oInN3aXBlbGVmdCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHNlbGYuc2xpZGVyLmNvbnRleHQub3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZSwgMSwgc2VsZi5zbGlkZXIuY29udGV4dCk7DQogICAgICAgIH0pOw0KDQogICAgICAgIGhhbW1lci5vbigic3dpcGVyaWdodCIsIGZ1bmN0aW9uKGUpIHsNCiAgICAgICAgICAgIHNlbGYuc2xpZGVyLmNvbnRleHQub3duZXIub25DaGFuZ2VDdXJyZW50U2xpZGUoZSwgLTEsIHNlbGYuc2xpZGVyLmNvbnRleHQpOw0KICAgICAgICB9KTsNCiAgICB9Ow0KDQogICAgQ2Fyb3VzZWwucHJvdG90eXBlLmRpc2FibGVFbXB0eVNsaWRlcyA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgZW1wdHlQbGFjZWhvbGRlcnMgPSB0aGlzLiRzbGlkZXMuZmluZCgiLnNjRW1wdHlQbGFjZWhvbGRlciIpLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXJDb2RlVGFnLA0KICAgICAgICAgICAgJHBsYWNlaG9sZGVyLA0KICAgICAgICAgICAgcGxhY2Vob2xkZXJJZCwNCiAgICAgICAgICAgIHBsYWNlaG9sZGVyS2V5LA0KICAgICAgICAgICAgZWRpdEZyYW1lLA0KICAgICAgICAgICAgY2hyb21lS2V5LA0KICAgICAgICAgICAgaDsNCg0KICAgICAgICBfLmVhY2goZW1wdHlQbGFjZWhvbGRlcnMsIGZ1bmN0aW9uKHBsYWNlaG9sZGVyKSB7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIgPSAkKHBsYWNlaG9sZGVyKTsNCiAgICAgICAgICAgIHBsYWNlaG9sZGVySWQgPSAkcGxhY2Vob2xkZXIuYXR0cigic2MtcGxhY2Vob2xkZXItaWQiKTsNCg0KICAgICAgICAgICAgLy9kaXNhYmxlIGVkaXQgZnJhbWVzDQogICAgICAgICAgICBwbGFjZWhvbGRlckNvZGVUYWcgPSAkcGxhY2Vob2xkZXIuc2libGluZ3MoImNvZGVbY2hyb21ldHlwZT0ncGxhY2Vob2xkZXInXVtpZD0nIiArIHBsYWNlaG9sZGVySWQgKyAiJ10iKTsNCiAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgcGxhY2Vob2xkZXJLZXkgPSBwbGFjZWhvbGRlckNvZGVUYWcuYXR0cigia2V5Iik7DQogICAgICAgICAgICAgICAgaWYgKHR5cGVvZihwbGFjZWhvbGRlcktleSkgPT09ICJzdHJpbmciKSB7DQogICAgICAgICAgICAgICAgICAgIGVkaXRGcmFtZSA9IFNpdGVjb3JlLlBhZ2VNb2Rlcy5DaHJvbWVNYW5hZ2VyLmNocm9tZXMoKS5maWx0ZXIoZnVuY3Rpb24oY2hyb21lKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBjaHJvbWVLZXkgPSBjaHJvbWUub3BlbmluZ01hcmtlcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFjaHJvbWVLZXkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgIGNocm9tZUtleSA9IGNocm9tZUtleS5hdHRyKCJrZXkiKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0eXBlb2YoY2hyb21lS2V5KSAhPT0gInVuZGVmaW5lZCIgJiYgY2hyb21lS2V5LmluZGV4T2YocGxhY2Vob2xkZXJLZXkpID09PSAwOw0KICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICBlZGl0RnJhbWVbMF0udHlwZS5jaHJvbWUuZGF0YS5jdXN0b20uZWRpdGFibGUgPSAiZmFsc2UiOw0KICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgIHRocm93IDY2NjsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9IGNhdGNoIChlKSB7IC8vZmFsbGJhY2sgLSBkZWxldGUgY29kZSB0YWdzIHRvIHByZXZlbnQgaW5zZXJ0aW5nIGludG8gcGxhY2Vob2xkZXJzDQogICAgICAgICAgICAgICAgJHBsYWNlaG9sZGVyLnNpYmxpbmdzKCJjb2RlW2Nocm9tZXR5cGU9J3BsYWNlaG9sZGVyJ10iKS5yZW1vdmUoKTsNCiAgICAgICAgICAgICAgICAvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICAgICAgY29uc29sZS5sb2coIkNvdWxkIG5vdCBkaXNhYmxlIGVkaXRpbmcgZm9yIHBsYWNlaG9sZGVyIiwgZSk7DQogICAgICAgICAgICAgICAgLyogZXNsaW50LWVuYWJsZSBuby1jb25zb2xlICovDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8vYWRqdXN0IGhlaWdodCwgYW5kIHJlbW92ZSBwbGFjZWhvbGRlciAiZGFzaGVkIiBiYWNrZ3JvdW5kDQogICAgICAgICAgICBoID0gJHBsYWNlaG9sZGVyLmhlaWdodCgpICsgInB4IjsNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5yZW1vdmVDbGFzcygic2NFbXB0eVBsYWNlaG9sZGVyIik7DQogICAgICAgICAgICAkcGxhY2Vob2xkZXIuY3NzKCJoZWlnaHQiLCBoKTsNCg0KICAgICAgICAgICAgLy9zZXQgZWRpdCBoZXJlIHRleHQNCiAgICAgICAgICAgICRwbGFjZWhvbGRlci5hcHBlbmQoJCgiPHA+W05vIGNvbXBvbmVudHMgaW4gc2xpZGVdPC9wPiIpKTsNCiAgICAgICAgfSk7DQogICAgfQ0KDQoNCiAgICBDYXJvdXNlbC5wcm90b3R5cGUucmVzaXplV3JhcHBlciA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgcGFnZUhlaWdodCA9ICQoZG9jdW1lbnQpLm91dGVySGVpZ2h0KCksDQogICAgICAgICAgICBoZWFkZXJIZWlnaHQgPSAkKCcjaGVhZGVyJykub3V0ZXJIZWlnaHQoKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nVG9wID0gcGFyc2VJbnQoJCgnI2NvbnRlbnQnKS5jc3MoJ3BhZGRpbmctdG9wJyksIDEwKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nQm90dG9tID0gcGFyc2VJbnQoJCgnI2NvbnRlbnQnKS5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKSwNCiAgICAgICAgICAgIGNvbnRlbnRQYWRkaW5nID0gY29udGVudFBhZGRpbmdUb3AgKyBjb250ZW50UGFkZGluZ0JvdHRvbSwNCiAgICAgICAgICAgIGZvb3RlckhlaWdodCA9ICQoJyNmb290ZXInKS5vdXRlckhlaWdodCgpLA0KICAgICAgICAgICAgd3JhcHBlciA9IHRoaXMuc2xpZGVyLmNvbnRleHQuJHdyYXBwZXIsDQogICAgICAgICAgICBjYXJvdXNlbEhlaWdodCA9IDA7DQoNCiAgICAgICAgY2Fyb3VzZWxIZWlnaHQgPSBwYWdlSGVpZ2h0IC0gKGhlYWRlckhlaWdodCArIGZvb3RlckhlaWdodCArIGNvbnRlbnRQYWRkaW5nKTsNCg0KICAgICAgICB3cmFwcGVyLmNzcyh7DQogICAgICAgICAgICAnaGVpZ2h0JzogY2Fyb3VzZWxIZWlnaHQNCiAgICAgICAgfSk7DQoNCiAgICAgICAgd3JhcHBlci5maW5kKCcuc2xpZGVzJykuY3NzKHsNCiAgICAgICAgICAgICdoZWlnaHQnOiBjYXJvdXNlbEhlaWdodA0KICAgICAgICB9KTsNCiAgICB9Ow0KDQoNCiAgICBwdWIuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAkKCIuY2Fyb3VzZWw6bm90KC5pbml0aWFsaXplZCkiKS5lYWNoKGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgdmFyIHByb3BlcnRpZXMgPSAkKHRoaXMpLmRhdGEoInByb3BlcnRpZXMiKSwNCiAgICAgICAgICAgICAgICBjb21wb25lbnQgPSAkKHRoaXMpLmZpbmQoIi5jYXJvdXNlbC1pbm5lciIpLA0KICAgICAgICAgICAgICAgIGlkID0gY29tcG9uZW50LmF0dHIoImRhdGEtaWQiKSwNCiAgICAgICAgICAgICAgICBzZWxmID0gdGhpczsNCg0KICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMpIHsNCiAgICAgICAgICAgICAgICBpZiAoIXByb3BlcnRpZXMubmF2aWdhdGlvbikgew0KICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24gPSB7DQogICAgICAgICAgICAgICAgICAgICAgICBpdGVtOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHByZXZJdGVtOiB7fSwNCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRJdGVtOiB7fQ0KICAgICAgICAgICAgICAgICAgICB9Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24uaXRlbS5zZWxlY3RvciA9ICJbZGF0YS1pZD0nIiArIGlkICsgIiddIC5uYXYtaXRlbXMiOyAvL3Byb3BlcnRpZXMubmF2aWdhdGlvbi5pdGVtLnNlbGVjdG9yOw0KICAgICAgICAgICAgICAgIHByb3BlcnRpZXMubmF2aWdhdGlvbi5wcmV2SXRlbS5zZWxlY3RvciA9ICIjIiArIGlkICsgIiAubmF2IjsNCiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzLm5hdmlnYXRpb24ubmV4dEl0ZW0uc2VsZWN0b3IgPSAiIyIgKyBpZCArICIgLm5hdiI7DQoNCiAgICAgICAgICAgICAgICB2YXIgY2Fyb3VzZWwgPSBuZXcgQ2Fyb3VzZWwoJCk7DQogICAgICAgICAgICAgICAgY2Fyb3VzZWwuaW5pdChjb21wb25lbnQsIHByb3BlcnRpZXMpOw0KDQogICAgICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICgkKHNlbGYpLmhhc0NsYXNzKCdjYXJvdXNlbC1jbGllbnRzJykpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIGNhcm91c2VsLnJlc2l6ZVdyYXBwZXIoKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgIGNhcm91c2VsLmRpc2FibGVFbXB0eVNsaWRlcygpOw0KICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgY2Fyb3VzZWwuc3dpcGVTbGlkZSgpOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoImluaXRpYWxpemVkIik7DQogICAgICAgIH0pOw0KICAgIH07DQoNCiAgICByZXR1cm4gcHViOw0KfShqUXVlcnkpKTsNCi8qKg0KICogZW5kIG9mIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMgbW9kdWxlLg0KICovDQoNCg0KWEEucmVnaXN0ZXIoImNhcm91c2VscyIsIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMpOw0KDQoNCi8qKg0KICogWEFDb250ZXh0DQogKg0KICogWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQogKg0KICogRXhwb3NlcyBUcmFuc2l0aW9uIGNsYXNzLCB3aGljaCBpcyBiYXNlIGNsYXNzIG9mIGFsbCB0cmFuc2l0aW9ucyB1c2VkIGJ5IGNhcm91c2VscyAoQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLCBAc2VlIFNsaWRlciwgQHNlZSBUcmFuc2l0aW9uKS4NCiAqIEFsc28gZXhwb3NlcyBpbXBsZW1lbnRhdGlvbiBvZiBiYXNpYyBlZmZlY3RzOg0KICogLSBCYXNpY1RyYW5zaXRpb24gLSB3aXRob3V0IGFueSBhbmltYXRpb24sDQogKiAtIEZhZGVJblRyYW5zaXRpb24gLSBuZXcgc2xpZGUgZmFkZXMgaW4sDQogKiAtIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiAtIG5ldyBzbGlkZSBtb3ZlcyBmcm9tIHJpZ2h0IChmcm9tIGxlZnQgaWYgdXNlciBzZWxlY3RzIHNsaWRlIHdpdGggbG93ZXIgaWQgb3IgY2xpY2tzIG9uICdwcmV2aW91cyBpdGVtJyksDQogKiAtIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gLSBuZXcgc2xpZGUgbW92ZXMgZnJvbSB0b3AgKGZyb20gYm90dG9tIGlmIHVzZXIgc2VsZWN0cyBzbGlkZSB3aXRoIGxvd2VyIGlkIG9yIGNsaWNrcyBvbiAncHJldmlvdXMgaXRlbScpLg0KICogQ2Fyb3VzZWwgdGFrZXMgdGhlIGNsYXNzIGNvbnN0cnVjdG9yIGJ5IG5hbWUgZnJvbSB0aGlzIG1vZHVsZSAoaXQgaXMgZ2l2ZW4gaW4gb3B0aW9ucyBvYmplY3Qgb2YgY2Fyb3VzZWw7IEBzZWUgWEEuY29tcG9uZW50LmNhcm91c2VscykuDQogKiBJZiB0aGVyZSBpcyBhIG5lZWQgdG8gaW1wbGVtZW50IHRoZSBuZXcgZWZmZWN0LCBjcmVhdGUgYSBuZXcgY2xhc3MsIGJ5IGluaGVyaXRpbmcgZnJvbSBUcmFuc2l0aW9uIGNsYXNzIGFuZCBhZGQgaXQgdG8gdGhpcyBtb2R1bGUuDQogKg0KICogRXhhbXBsZSBlZmZlY3QgaW1wbGVtZW50YXRpb24gKGN1cnJlbnRseSBkaXNwbGF5ZWQgc2xpZGUgaXMgc2hyaW5raW5nIHRvIGNlbnRlciBvZiB0aGUgY2Fyb3VzZWwpOg0KICogKGZ1bmN0aW9uICgpIHsNCiogICAgIGZ1bmN0aW9uIFNhbXBsZVRyYW5zaXRpb24oKSB7IH0NCioNCiogICAgIC8vaW5oZXJpdCBmcm9tIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMuVHJhbnNpdGlvbg0KKiAgICAgU2FtcGxlVHJhbnNpdGlvbi5wcm90b3R5cGUgPSBuZXcgWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucy5UcmFuc2l0aW9uKCk7DQoqICAgICBTYW1wbGVUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2FtcGxlVHJhbnNpdGlvbjsNCioNCiogICAgIFNhbXBsZVRyYW5zaXRpb24ucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsNCiogICAgICAgICAvL3Bvc2l0aW9uaW5nIGFsbCBzbGlkZXMgaW4gdGhlIHRvcCBsZWZ0IGNvcm5lciBvZiB0aGUgY2Fyb3VzZWwNCiogICAgICAgICBzZXR0aW5ncy4kc2xpZGVzLmNzcyh7DQoqICAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQoqICAgICAgICAgICAgICd0b3AnOiAnMHB4JywNCiogICAgICAgICAgICAgJ2xlZnQnOiAnMHB4Jw0KKiAgICAgICAgIH0pOw0KKiAgICAgfTsNCioNCiogICAgIFNhbXBsZVRyYW5zaXRpb24ucHJvdG90eXBlLm9uQW5pbWF0aW9uQ29tcGxldGUgPSBmdW5jdGlvbihzZXR0aW5ncywgd2lkdGgsIGhlaWdodCkgew0KKiAgICAgICAgIHZhciB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQoqICAgICAgICAgJGN1cnJlbnQgPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlOw0KKg0KKiAgICAgICAgICRjdXJyZW50LmhpZGUoKTsNCiAgICAgICAgICAvL3JldmVydGluZyBjaGFuZ2VzIGluIGNzcyBwcm9wZXJ0aWVzDQoqICAgICAgICAgJGN1cnJlbnQuY3NzKHsNCiogICAgICAgICAgICAgJ3dpZHRoJzogd2lkdGgsDQoqICAgICAgICAgICAgICdoZWlnaHQnOiBoZWlnaHQsDQoqICAgICAgICAgICAgICdsZWZ0JzogMCwNCiogICAgICAgICAgICAgJ3RvcCc6IDANCiogICAgICAgICB9KTsNCiogICAgICAgICAkY3VycmVudC5jc3MoekluZGV4QXR0cmliLCAnJyk7DQoqICAgICAgICAgc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKS5jc3MoekluZGV4QXR0cmliLCAnJyk7DQoqDQoqICAgICAgICAgLy9ub3RpZnlpbmcgdGhlIGNhcm91c2VsLCB0aGF0IGFuaW1hdGlvbiBpcyBjb21wbGV0ZWQNCiogICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KKiAgICAgfTsNCioNCiogICAgIFNhbXBsZVRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbiAoc2V0dGluZ3MpIHsNCiogICAgICAgICB2YXIgaGVpZ2h0ID0gc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oZWlnaHQoKSwNCiogICAgICAgICB3aWR0aCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUud2lkdGgoKSwNCiogICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlZCA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwNCiogICAgICAgICB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQoqICAgICAgICAgJHBhcmVudCA9IHNldHRpbmdzLiRzbGlkZXMucGFyZW50KCksDQoqICAgICAgICAgJGN1cnJlbnQgPSBzZXR0aW5ncy4kY3VycmVudFNsaWRlLA0KKiAgICAgICAgICRuZXh0ID0gc2V0dGluZ3MuJG5leHRTbGlkZTsNCioNCiogICAgICAgICAvL3NldHRpbmcgYSBuZXcgc2xpZGUgdW5kZXIgdGhlIGN1cnJlbnQgc2xpZGUNCiogICAgICAgICAkcGFyZW50LmNzcyh6SW5kZXhBdHRyaWIsIDApOw0KKiAgICAgICAgICRjdXJyZW50LmNzcyh6SW5kZXhBdHRyaWIsIDEpOw0KKiAgICAgICAgICRuZXh0LnNob3coKTsNCioNCiogICAgICAgICAvL2FuaW1hdGUgY3VycmVudCBzbGlkZQ0KKiAgICAgICAgICRjdXJyZW50LmFuaW1hdGUoew0KKiAgICAgICAgICAgICAnd2lkdGgnOiAnMHB4JywNCiogICAgICAgICAgICAgJ2hlaWdodCc6ICcwcHgnLA0KKiAgICAgICAgICAgICAnbGVmdCc6IHdpZHRoIC8gMiwNCiogICAgICAgICAgICAgJ3RvcCc6IGhlaWdodCAvIDINCiogICAgICAgICB9LCBmdW5jdGlvbigpIHsNCiogICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZWQoc2V0dGluZ3MsIHdpZHRoLCBoZWlnaHQpOw0KKiAgICAgICAgIH0pOw0KKiAgICAgfTsNCioNCiogICAgIC8vYWRkaW5nIG5ldyBlZmZlY3QgdG8gWEEuY29tcG9uZW50LmNhcm91c2Vscy5UcmFuc2l0aW9ucyBtb2R1bGUuDQoqICAgICBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zLlNhbXBsZVRyYW5zaXRpb24gPSBTYW1wbGVUcmFuc2l0aW9uOw0KKiB9ICgpKTsNCiAqDQogKi8NClhBLmNvbXBvbmVudC5jYXJvdXNlbHMuVHJhbnNpdGlvbnMgPSAoZnVuY3Rpb24oKSB7DQogICAgdmFyIHB1YiA9IHt9Ow0KDQogICAgLyoqDQogICAgICogVHJhbnNpdGlvblNldHRpbmdzIGNsYXNzIGhvbGRzIGRhdGEgbmVlZGVkIGZvciBjaGFuZ2luZyBzbGlkZXMNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBUcmFuc2l0aW9uU2V0dGluZ3MoKSB7fQ0KICAgIC8qKg0KICAgICAqIEN1cnJlbnQgc2xpZGUgKGN1cnJlbnRseSBkaXNwbGF5ZWQpIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kY3VycmVudFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBOZXh0IHNsaWRlIGpRdWVyeSBvYmplY3QNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS4kbmV4dFNsaWRlID0gbnVsbDsNCiAgICAvKioNCiAgICAgKiBBbGwgc2xpZGVzIChqUXVlcnkgb2JqZWN0KQ0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uU2V0dGluZ3MNCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uU2V0dGluZ3MucHJvdG90eXBlLiRzbGlkZXMgPSBudWxsOw0KICAgIC8qKg0KICAgICAqIE9mZnNldCBiZXR3ZWVuICRjdXJyZW50U2xpZGUgYW5kICRuZXh0U2xpZGUNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5vZmZzZXQgPSAwOw0KICAgIC8qKg0KICAgICAqIENhbGxiYWNrIGZ1bmN0aW9uIHdoaWNoIG11c3QgYmUgY2FsbGVkIGFmdGVyIGFuaW1hdGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvblNldHRpbmdzDQogICAgICovDQogICAgVHJhbnNpdGlvblNldHRpbmdzLnByb3RvdHlwZS5jYWxsYmFjayA9IG51bGw7DQogICAgLyoqDQogICAgICogZW5kIG9mIFRyYW5zaXRpb25TZXR0aW5ncyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5UcmFuc2l0aW9uU2V0dGluZ3MgPSBUcmFuc2l0aW9uU2V0dGluZ3M7DQoNCiAgICAvKioNCiAgICAgKiBUcmFuc2l0aW9uIGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgdHJhbnNpdGlvbnMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIGV4ZWN1dGlvbiB0aGUgcGVyZm9ybSgpIG1ldGhvZC4NCiAgICAgKg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFRyYW5zaXRpb24oKSB7fQ0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlID0gbmV3IFRyYW5zaXRpb24oKTsNCiAgICAvKioNCiAgICAgKiBJbml0aWFsaXplcyBhIHRyYW5zaXRpb24gd2l0aCBnaXZlbiBzZXR0aW5ncyAoQHNlZSBUcmFuc2l0aW9uU2V0dGluZ3MpLg0KICAgICAqIA0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIC8qIGVzbGludC1kaXNhYmxlICovDQogICAgVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIC8vaW1wbGVtZW50YXRpb24gdXNpbmcgc2V0dGluZ3MNCiAgICB9Ow0KICAgIC8qIGVzbGludC1lbmFibGUgKi8NCiAgICAvKioNCiAgICAgKiBSZXR1cm5zIGEgZmFjdG9yIGFzc29jaWF0ZWQgd2l0aCBzZXR0aW5ncy5vZmZzZXQgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSwgd2hpY2gNCiAgICAgKiBjYW4gYmUgdXNlZnVsbCBmb3Igc29tZSBhbmltYXRpb25zLg0KICAgICAqDQogICAgICogQG1lbWJlciBUcmFuc2l0aW9uDQogICAgICogQHBhcmFtIHtUcmFuc2l0aW9uU2V0dGluZ3N9IHNldHRpbmdzICB0cmFuc2l0aW9uIHNldHRpbmdzDQogICAgICogQHJldHVybiBUaGUgZmFjdG9yOyAxIGlmIG9mZnNldCBpcyBoaWdoZXIgdGhhbiAwLCAtMSBvdGhlcndpc2UNCiAgICAgKiBAdHlwZSBOdW1iZXINCiAgICAgKi8NCiAgICBUcmFuc2l0aW9uLnByb3RvdHlwZS5mYWN0b3IgPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICByZXR1cm4gKHNldHRpbmdzLm9mZnNldCA+IDApID8gMSA6IC0xOw0KICAgIH07DQogICAgLyoqDQogICAgICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIHVzZWQgYnkgY2Fyb3VzZWxzIHRvIGNoYW5nZSBzbGlkZXMuDQogICAgICoNCiAgICAgKiBJbXBvcnRhbnQ6IHNldHRpbmdzLmNhbGxiYWNrKCkgKEBzZWUgVHJhbnNpdGlvblNldHRpbmdzKSBoYXZlIHRvIGJlIGNhbGxlZCBhdCB0aGUgZW5kIG9mIHRoaXMgbWV0aG9kIGV4ZWN1dGlvbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVHJhbnNpdGlvbg0KICAgICAqIEBwYXJhbSB7VHJhbnNpdGlvblNldHRpbmdzfSBzZXR0aW5ncyAgdHJhbnNpdGlvbiBzZXR0aW5ncw0KICAgICAqLw0KICAgIFRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICBzZXR0aW5ncy5jYWxsYmFjaygpOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuVHJhbnNpdGlvbiA9IFRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBCYXNpY1RyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgd2l0aG91dCBhbnkgYW5pbWF0aW9uLg0KICAgICAqIERvIG5vdCByZW1vdmUgdGhpcyBjbGFzcywgYmVjYW91c2UgY2Fyb3VzZWxzIHdpbGwgdXNlIGl0IGJ5IGRlZmF1bHQsDQogICAgICogaWYgcmVxdWVzdGVkIHRyYW5zaXRpb24gY2Fubm90IGJlIGZvdW5kLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIEJhc2ljVHJhbnNpdGlvbigpIHt9DQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgQmFzaWNUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gQmFzaWNUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgQmFzaWNUcmFuc2l0aW9uDQogICAgICovDQogICAgQmFzaWNUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuc2hvdygpOw0KDQogICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgQmFzaWNUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLkJhc2ljVHJhbnNpdGlvbiA9IEJhc2ljVHJhbnNpdGlvbjsNCg0KICAgIC8qKg0KICAgICAqIEZhZGVJblRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgZmFkaW5nIGluIG5ldyBzbGlkZS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBGYWRlSW5UcmFuc2l0aW9uKCkge30NCiAgICBGYWRlSW5UcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgRmFkZUluVHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IEZhZGVJblRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkgew0KICAgICAgICAvKnNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgICB9KTsqLw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBGYWRlSW5UcmFuc2l0aW9uDQogICAgICovDQogICAgRmFkZUluVHJhbnNpdGlvbi5wcm90b3R5cGUucGVyZm9ybSA9IGZ1bmN0aW9uKHNldHRpbmdzKSB7DQogICAgICAgIHZhciB6SW5kZXhBdHRyaWIgPSAnei1pbmRleCcsDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKSwNCiAgICAgICAgICAgICRuZXh0U2xpZGUgPSBzZXR0aW5ncy4kbmV4dFNsaWRlOw0KDQogICAgICAgICRwYXJlbnQuY3NzKHpJbmRleEF0dHJpYiwgMCk7DQogICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgMSk7DQogICAgICAgIHNldHRpbmdzLiRzbGlkZXMuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdyZWxhdGl2ZScNCiAgICAgICAgfSk7DQoNCiAgICAgICAgc2V0dGluZ3MuJG5leHRTbGlkZS5jc3Moew0KICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ2Fic29sdXRlJywNCiAgICAgICAgICAgICd0b3AnOiAnMHB4JywNCiAgICAgICAgICAgICdsZWZ0JzogJzBweCcNCiAgICAgICAgfSk7DQoNCg0KICAgICAgICAkbmV4dFNsaWRlLmZhZGVJbihmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KDQogICAgICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAgICAgJ3Bvc2l0aW9uJzogJ3JlbGF0aXZlJw0KICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICRuZXh0U2xpZGUuY3NzKHpJbmRleEF0dHJpYiwgJycpOw0KICAgICAgICAgICAgJHBhcmVudC5jc3MoekluZGV4QXR0cmliLCAnJyk7DQoNCiAgICAgICAgICAgIHNldHRpbmdzLmNhbGxiYWNrKCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIEZhZGVJblRyYW5zaXRpb24gY2xhc3MNCiAgICAgKi8NCiAgICBwdWIuRmFkZUluVHJhbnNpdGlvbiA9IEZhZGVJblRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gY2xhc3MgY2hhbmdlcyBzbGlkZXMgYnkgc2xpZGluZyB0aGVtIGhvcml6b250YWxseS4NCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIGVmZmVjdCBpcyBub3QgdXNlZC4NCiAgICAgKiBJZiBvZmZzZXQgKGRpZmZlcmVuY2UgYmV0d2VlbiBpbmRleCBvZiBjdXJyZW50bHkgZGlzcGxheWVkIHNsaWRlIGFuZCBpbmRleCBvZiBzbGlkZSB0aGF0IHdpbGwgYmUgc2hvd24pDQogICAgICogaXMgZ3JlYXRlciB0aGFuIDAsIHNsaWRlcyBhcmUgc2xpZGluZyB0byB0aGUgbGVmdC4gT3RoZXJ3aXNlIChvZmZzZXQgaXMgbG93ZXIgdGhhbiAwKSwgc2xpZGVzIGFyZSBzbGlkaW5nDQogICAgICogdG8gdGhlIGxlZnQuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgdG8gcmlnaHQgKG9mZnNldCA9PSAxKS4NCiAgICAgKiBJZiB1c2VyIHJhaXNlcyBzbGlkZXMgY2hhbmdlLCBzbGlkZXMgYXJlIHNsaWRpbmc6DQogICAgICogLSB0byBsZWZ0LCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSB0byByaWdodCwgaWYgb2Zmc2V0IGlzIGxvd2VyIHRoYW4gMCAoc2xpZGUgd2l0aCBsb3dlciBpbmRleCB3aWxsIGJlIHNob3duIG9yIHVzZXIgY2xpY2tzIG9uICdwcmV2JyBuYXZpZ2F0aW9uIGl0ZW0pLg0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbigpIHt9DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLmNvbnN0cnVjdG9yID0gU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uOw0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5vbkFuaW1hdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24oc2V0dGluZ3MsICRwYXJlbnQpIHsNCiAgICAgICAgc2V0dGluZ3MuJGN1cnJlbnRTbGlkZS5oaWRlKCk7DQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICcnLA0KICAgICAgICAgICAgJ3RvcCc6ICcnLA0KICAgICAgICAgICAgJ2xlZnQnOiAnJw0KICAgICAgICB9KTsNCg0KICAgICAgICAkcGFyZW50LmNzcygnbWFyZ2luLWxlZnQnLCAnJyk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVIb3Jpem9udGFsbHlUcmFuc2l0aW9uLnByb3RvdHlwZS5wZXJmb3JtID0gZnVuY3Rpb24oc2V0dGluZ3MpIHsNCiAgICAgICAgdmFyIGZhY3RvciA9IHRoaXMuZmFjdG9yKHNldHRpbmdzKSwNCiAgICAgICAgICAgIG9uQW5pbWF0aW9uQ29tcGxldGUgPSB0aGlzLm9uQW5pbWF0aW9uQ29tcGxldGUsDQogICAgICAgICAgICB3aWR0aCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUud2lkdGgoKSwNCiAgICAgICAgICAgICRwYXJlbnQgPSBzZXR0aW5ncy4kc2xpZGVzLnBhcmVudCgpOw0KDQogICAgICAgIHNldHRpbmdzLiRuZXh0U2xpZGUuY3NzKHsNCiAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsDQogICAgICAgICAgICAndG9wJzogJzBweCcsDQogICAgICAgICAgICAnbGVmdCc6IGZhY3RvciAqIHdpZHRoDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ21hcmdpbi1sZWZ0JzogLWZhY3RvciAqIHdpZHRoDQogICAgICAgIH0sIGZ1bmN0aW9uKCkgew0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZShzZXR0aW5ncywgJHBhcmVudCk7DQogICAgICAgIH0pOw0KICAgIH07DQogICAgLyoqDQogICAgICogRW5kIG9mIFNsaWRlSG9yaXpvbnRhbGx5VHJhbnNpdGlvbiBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5TbGlkZUhvcml6b250YWxseVRyYW5zaXRpb24gPSBTbGlkZUhvcml6b250YWxseVRyYW5zaXRpb247DQoNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzIGNoYW5nZXMgc2xpZGVzIGJ5IHNsaWRpbmcgdGhlbSB2ZXJ0aWNhbGx5Lg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBlZmZlY3QgaXMgbm90IHVzZWQuDQogICAgICogSWYgb2Zmc2V0IChkaWZmZXJlbmNlIGJldHdlZW4gaW5kZXggb2YgY3VycmVudGx5IGRpc3BsYXllZCBzbGlkZSBhbmQgaW5kZXggb2Ygc2xpZGUgdGhhdCB3aWxsIGJlIHNob3duKQ0KICAgICAqIGlzIGdyZWF0ZXIgdGhhbiAwLCBzbGlkZXMgYXJlIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duLiBPdGhlcndpc2UgKG9mZnNldCBpcyBsb3dlciB0aGFuIDApLCBzbGlkZXMgYXJlIHNsaWRpbmcNCiAgICAgKiBmcm9tIGRvd24gdG8gdXAuDQogICAgICogV2hlbiBzbGlkZSBjaGFuZ2UgaXMgcmFpc2VkIGF1dG9tYXRpY2FsbHksIHNsaWRlcyBhcmUgYWx3YXlzIHNsaWRpbmcgZnJvbSB1cCB0byBkb3duIChvZmZzZXQgPT0gMSkuDQogICAgICogSWYgdXNlciByYWlzZXMgc2xpZGVzIGNoYW5nZSwgc2xpZGVzIGFyZSBzbGlkaW5nOg0KICAgICAqIC0gZnJvbSB1cCB0byBkb3duLCBpZiBvZmZzZXQgaXMgZ3JlYXRlciB0aGFuIDAgKHNsaWRlIHdpdGggaGlnaGVyIGluZGV4IHdpbGwgYmUgc2hvd24gb3IgdXNlciBjbGlja3Mgb24gJ25leHQnIG5hdmlnYXRpb24gaXRlbSksDQogICAgICogLSBmcm9tIGRvd24gdG8gdXAsIGlmIG9mZnNldCBpcyBsb3dlciB0aGFuIDAgKHNsaWRlIHdpdGggbG93ZXIgaW5kZXggd2lsbCBiZSBzaG93biBvciB1c2VyIGNsaWNrcyBvbiAncHJldicgbmF2aWdhdGlvbiBpdGVtKS4NCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKi8NCiAgICBmdW5jdGlvbiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uKCkge30NCiAgICBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uLnByb3RvdHlwZSA9IG5ldyBUcmFuc2l0aW9uKCk7DQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5jb25zdHJ1Y3RvciA9IFNsaWRlVmVydGljYWxseVRyYW5zaXRpb247DQogICAgLyoqDQogICAgICogQG1lbWJlciBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uDQogICAgICovDQogICAgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbi5wcm90b3R5cGUub25BbmltYXRpb25Db21wbGV0ZSA9IGZ1bmN0aW9uKHNldHRpbmdzLCAkcGFyZW50KSB7DQogICAgICAgIHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGlkZSgpOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnJywNCiAgICAgICAgICAgICd0b3AnOiAnJywNCiAgICAgICAgICAgICdsZWZ0JzogJycNCiAgICAgICAgfSk7DQoNCiAgICAgICAgJHBhcmVudC5jc3MoJ21hcmdpbi10b3AnLCAnJyk7DQoNCiAgICAgICAgc2V0dGluZ3MuY2FsbGJhY2soKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgU2xpZGVWZXJ0aWNhbGx5VHJhbnNpdGlvbg0KICAgICAqLw0KICAgIFNsaWRlVmVydGljYWxseVRyYW5zaXRpb24ucHJvdG90eXBlLnBlcmZvcm0gPSBmdW5jdGlvbihzZXR0aW5ncykgew0KICAgICAgICB2YXIgZmFjdG9yID0gdGhpcy5mYWN0b3Ioc2V0dGluZ3MpLA0KICAgICAgICAgICAgb25BbmltYXRpb25Db21wbGV0ZSA9IHRoaXMub25BbmltYXRpb25Db21wbGV0ZSwNCiAgICAgICAgICAgIGhlaWdodCA9IHNldHRpbmdzLiRjdXJyZW50U2xpZGUuaGVpZ2h0KCksDQogICAgICAgICAgICAkcGFyZW50ID0gc2V0dGluZ3MuJHNsaWRlcy5wYXJlbnQoKTsNCg0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLmNzcyh7DQogICAgICAgICAgICAncG9zaXRpb24nOiAnYWJzb2x1dGUnLA0KICAgICAgICAgICAgJ3RvcCc6IC1mYWN0b3IgKiBoZWlnaHQsDQogICAgICAgICAgICAnbGVmdCc6ICcwcHgnDQogICAgICAgIH0pOw0KICAgICAgICBzZXR0aW5ncy4kbmV4dFNsaWRlLnNob3coKTsNCg0KICAgICAgICAkcGFyZW50LmFuaW1hdGUoew0KICAgICAgICAgICAgJ21hcmdpbi10b3AnOiBmYWN0b3IgKiBoZWlnaHQNCiAgICAgICAgfSwgZnVuY3Rpb24oKSB7DQogICAgICAgICAgICBvbkFuaW1hdGlvbkNvbXBsZXRlKHNldHRpbmdzLCAkcGFyZW50KTsNCiAgICAgICAgfSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uIGNsYXNzDQogICAgICovDQogICAgcHViLlNsaWRlVmVydGljYWxseVRyYW5zaXRpb24gPSBTbGlkZVZlcnRpY2FsbHlUcmFuc2l0aW9uOw0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLlRyYW5zaXRpb25zIG1vZHVsZS4NCiAqLw0KDQovKioNCiAqIFhBQ29udGV4dA0KICoNCiAqIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMuSW5kaWNhdG9yVmlld3MgbW9kdWxlLg0KICoNCiAqIEV4cG9zZXMgVmlldyBjbGFzcywgd2hpY2ggaXMgYSBiYXNlIGNsYXNzIG9mIGFsbCAndGltZSBpbmRpY2F0b3InIHZpZXdzIHVzZWQgYnkgY2Fyb3VzZWxzIChAc2VlIFhBLmNvbXBvbmVudC5jYXJvdXNlbHMsIEBzZWUgVmlldykuDQogKiBBbHNvIGV4cG9zZXMgaW1wbGVtZW50YXRpb24gb2YgdGhlc2UgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3czoNCiAqIC0gUHJvZ3Jlc3NCYXJWaWV3IC0gc2hvd3MgdGhlIHByb2dyZXNzIG9mIHRpbWUsIHRoYXQgbG9va3MgbGlrZSBhIHByb2dyZXNzIGJhciwNCiAqIC0gUm90YXRvclZpZXcgLSBzaG93cyB0aGUgcHJvZ3Jlc3Mgb2YgdGltZSB3aXRoIHRoZSBmaWxsaW5nIHVwIHJpbmcuDQogKiBDYXJvdXNlbCB0YWtlcyB0aGUgY2xhc3MgY29uc3RydWN0b3IgYnkgbmFtZSBmcm9tIHRoaXMgbW9kdWxlIChpdCBpcyBnaXZlbiBpbiBvcHRpb25zIG9iamVjdCBvZiBjYXJvdXNlbDsgQHNlZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzKS4NCiAqIElmIHRoZXJlIGlzIGEgbmVlZCB0byBpbXBsZW1lbnQgdGhlIG5ldyAndGltZSBpbmRpY2F0b3InIHZpZXcsIGNyZWF0ZSBhIG5ldyBjbGFzcywNCiAqIGJ5IGluaGVyaXRpbmcgZnJvbSBWaWV3IGNsYXNzIGFuZCBhZGQgaXQgdG8gdGhpcyBtb2R1bGUuIER1cmluZyBpbXBsZW1lbnRhdGlvbiBvZiBhIG5ldyAndGltZSBpbmRpY2F0b3InDQogKiB2aWV3IHRoZSBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvcnNWaWV3LlRvb2xzIG5hbWVzcGFjZSBtYXkgYmUgdXNlZnVsbC4gSXQgY29udGFpbnM6DQogKiAtIGlzQ3NzU3VwcG9ydGVkKHByb3BzKSBmdW5jdGlvbiwgd2hpY2ggY2hlY2tzIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQgKHByb3BzIC0gYXJyYXkgb2YgcHJvcGVydGllcyksDQogKiAtIGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkgZnVuY3Rpb24sIHdoaWNoIGNoZWNrcyBpZiBDU1MgMyAndHJhbnNmb3JtJyBpcyBzdXBwb3J0ZWQuDQogKg0KICogRXhhbXBsZSB2aWV3IGltcGxlbWVudGF0aW9uIChvcGFjaXR5IGluY3JlYXNlcyB3aXRoIGEgcHJvZ3Jlc3Mgb2YgdGhlIHRpbWUpOg0KICogKGZ1bmN0aW9uKCkgew0KICogICAgIHZhciBWaWV3ID0gWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5WaWV3Ow0KICoNCiAqICAgICBmdW5jdGlvbiBTYW1wbGVWaWV3IChzZWxlY3Rvciwgb3B0aW9ucykgew0KICogICAgICAgICAvL2Jhc2UgY29uc3RydWN0b3IgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCiAqICAgICB9DQogKg0KICogICAgIFNhbXBsZVZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAqICAgICBTYW1wbGVWaWV3LmNvbnN0cnVjdG9yID0gU2FtcGxlVmlldzsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICh0aW1lb3V0KSB7DQogKiAgICAgICAgIC8vYmFzZSBtZXRob2QgaGF2ZSB0byBiZSBjYWxsZWQNCiAqICAgICAgICAgVmlldy5wcm90b3R5cGUuaW5pdC5jYWxsKHRoaXMsIHRpbWVvdXQpOw0KICoNCiAqICAgICAgICAgLy9pbml0aWFsaXphdGlvbiBjb2RlIC0gbm90IG5lZWRlZCBpbiB0aGlzIGV4YW1wbGUNCiAqICAgICB9Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9iYXNlIG1ldGhvZCBoYXZlIHRvIGJlIGNhbGxlZA0KICogICAgICAgICBWaWV3LnByb3RvdHlwZS5yZXNldC5jYWxsKHRoaXMpOw0KICoNCiAqICAgICAgICAgLy9yZXNldGluZyAndGltZSBpbmRpY2F0b3InIHZpZXcNCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5jc3MoJ29wYWNpdHknLCAwKTsNCiAqICAgICB9Ow0KICoNCiAqICAgICBTYW1wbGVWaWV3LnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9zdG9waW5nICd0aW1lIGluZGljYXRvcicgdmlldyBhbmltYXRpb24NCiAqICAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgU2FtcGxlVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uICgpIHsNCiAqICAgICAgICAgLy9zdGFydGluZy9yZXN1bWluZyAndGltZSBpbmRpY2F0b3InIHZpZXcgYW5pbWF0aW9uDQogKiAgICAgICAgIHRoaXMuJGluZGljYXRvci5hbmltYXRlKHsNCiAqICAgICAgICAgICAgICdvcGFjaXR5JzogMQ0KICogICAgICAgICB9LCB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkLCAnbGluZWFyJyk7DQogKiAgICAgfTsNCiAqDQogKiAgICAgWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5TYW1wbGVWaWV3ID0gU2FtcGxlVmlldzsNCiAqIH0oKSk7DQogKg0KICovDQpYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzID0gKGZ1bmN0aW9uKCQpIHsNCiAgICB2YXIgcHViID0ge30sDQogICAgICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBudWxsOw0KDQogICAgLyoqDQogICAgICogQ2hlY2tzIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge0FycmF5fSBwcm9wcyAgICAgYXJyYXkgb2YgcHJvcGVydGllcyB0byBiZSBjaGVja2VkDQogICAgICogQHJldHVybiB0cnVlIGlmIGFueSBvZiBDU1MgcHJvcGVydGllcyBpcyBzdXBwb3J0ZWQsIGZhbHNlIG90aGVyd2lzZQ0KICAgICAqIEB0eXBlIEJvb2xlYW4NCiAgICAgKi8NCiAgICBmdW5jdGlvbiBpc0Nzc1N1cHBvcnRlZChwcm9wcykgew0KICAgICAgICB2YXIgaSwNCiAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gZmFsc2U7DQoNCiAgICAgICAgaWYgKHN1cHBvcnRFbGVtZW50U3R5bGUgPT09IG51bGwpIHsNCiAgICAgICAgICAgIHN1cHBvcnRFbGVtZW50U3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdXBwb3J0RWxlbWVudCcpLnN0eWxlOw0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIChpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICBpZiAoc3VwcG9ydEVsZW1lbnRTdHlsZVtwcm9wc1tpXV0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGlzU3VwcG9ydGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBpc1N1cHBvcnRlZDsNCiAgICB9DQoNCiAgICAvKioNCiAgICAgKiBDaGVja3MgaWYgQ1NTIDMgJ3RyYW5zZm9ybScgaXMgc3VwcG9ydGVkLg0KICAgICAqDQogICAgICogQHJldHVybiB0cnVlIGlmIENTUyAzICd0cmFuc2Zvcm0nIGlzIHN1cHBvcnRlZCwgZmFsc2Ugb3RoZXJ3aXNlDQogICAgICogQHR5cGUgQm9vbGVhbg0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkgew0KICAgICAgICByZXR1cm4gaXNDc3NTdXBwb3J0ZWQoWyd0cmFuc2Zvcm1Qcm9wZXJ0eScsICdXZWJraXRUcmFuc2Zvcm0nLCAnTW96VHJhbnNmb3JtJywgJ09UcmFuc2Zvcm0nLCAnbXNUcmFuc2Zvcm0nXSk7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogWEEuY29tcG9uZW50LmNhcm91c2Vscy5JbmRpY2F0b3JWaWV3cy5Ub29scyBuYW1lc3BhY2UNCiAgICAgKg0KICAgICBUaGlzIG5hbWVzcGFjZSBjYW4gYmUgcmVtb3ZlZCBpZiBSb3RhdG9yVmlldyBjbGFzcyBpcyBub3QgdXNlZCAoQHNlZSBSb3RhdG9yVmlldykNCiAgICAgKi8NCiAgICBwdWIuVG9vbHMgPSB7fTsNCiAgICBwdWIuVG9vbHMuaXNDc3NTdXBwb3J0ZWQgPSBpc0Nzc1N1cHBvcnRlZDsNCiAgICBwdWIuVG9vbHMuaXNUcmFuc2Zvcm1TdXBwb3J0ZWQgPSBpc1RyYW5zZm9ybVN1cHBvcnRlZDsNCiAgICAvKioNCiAgICAgKiBFbmQgb2YgbmFtZXNwYWNlDQogICAgICovDQoNCiAgICAvKioNCiAgICAgKiBWaWV3IGNsYXNzIGlzIGEgYmFzZSBjbGFzcyBvZiBhbGwgJ3RpbWUgaW5kaWNhdG9yJyB2aWV3cw0KICAgICAqIEBjb25zdHJ1Y3Rvcg0KICAgICAqIEBwYXJhbSB7U3RyaW5nfSBzZWxlY3RvciBhIHNlbGVjdG9yIHVzZWQgZm9yIHNlYXJjaGluZw0KICAgICAqIEBwYXJhbSB7T2JqZWN0fSBvcHRpb25zICAgVmlldyBvcHRpb25zIG9iamVjdA0KICAgICAqLw0KICAgIC8qIGVzbGludC1kaXNhYmxlICovDQogICAgZnVuY3Rpb24gVmlldyhzZWxlY3Rvciwgb3B0aW9ucykgew0KICAgICAgICAvKioNCiAgICAgICAgICogQSBqUXVlcnkgb2JqZWN0IGNvbnRhaW5pbmcgZWxlbWVudCwgd2hpY2ggd2lsbCBiZSBhbmltYXRlZCB0byBzaG93IHBvZ3Jlc3Mgb2YgdGhlIHRpbWUuDQogICAgICAgICAqDQogICAgICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAgICAgKi8NCg0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IgPSAkKHNlbGVjdG9yKTsNCiAgICB9DQogICAgLyogZXNsaW50LWVuYWJsZSAqLw0KICAgIC8qKg0KICAgICAqIEluaXRpYWxpemVzIHRoZSB2aWV3Lg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3aW9uDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHRpbWVvdXQgICBhIHRpbWVvdXQgdG8gdGhlIGVuZCBvZiB3aG9sZSBpbmRpY2F0b3IgYW5pbWF0aW9uDQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKHRpbWVvdXQpIHsNCiAgICAgICAgdGhpcy50aW1lRWxhcHNlZCA9IDA7DQogICAgICAgIHRoaXMudGltZW91dCA9IHRpbWVvdXQ7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBSZXNldHMgdGhlIHZpZXcNCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSAwOw0KICAgIH07DQogICAgLyoqDQogICAgICogU3RhcnRzL1JlbmV3cyB0aGUgdmlldyBhbmltYXRpb24uDQogICAgICoNCiAgICAgKiBAbWVtYmVyIFZpZXcNCiAgICAgKi8NCiAgICBWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7fTsNCiAgICAvKioNCiAgICAgKiBQYXVzZXMgdGhlIHZpZXcgYW5pbWF0aW9uLg0KICAgICAqDQogICAgICogQG1lbWJlciBWaWV3DQogICAgICovDQogICAgVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHt9Ow0KICAgIC8qKg0KICAgICAqIFVwZGF0ZXMgdGhlIHRpbWUgdGhhdCBlbGFwc2VkIHNpbmNlIGFuaW1hdGlvbiBiZWdpbi4NCiAgICAgKg0KICAgICAqIEBtZW1iZXIgVmlldw0KICAgICAqLw0KICAgIFZpZXcucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uKHRpbWVFbGFwc2VkKSB7DQogICAgICAgIHRoaXMudGltZUVsYXBzZWQgPSB0aW1lRWxhcHNlZDsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBWaWV3IGNsYXNzDQogICAgICovDQogICAgcHViLlZpZXcgPSBWaWV3Ow0KDQogICAgLyoqDQogICAgICogUHJvZ3Jlc3NCYXJWaWV3IGNsYXNzIHByb3ZpZGVzIGEgbG9naWMgZm9yIGFuaW1hdGUgYSAndGltZSBpbmRpY2F0b3InLA0KICAgICAqIHRoYXQgbG9va3MgbGlrZSBwcm9ncmVzcyBiYXIuDQogICAgICoNCiAgICAgKiBPcHRpb25zIG9iamVjdDoNCiAgICAgKiB7DQogICAgICogICAgICdvcGFjaXR5JzogTnVtYmVyIHZhbHVlIC8vYmV0d2VlbiAwIGFuZCAxOyBkZWZhdWx0IGlzIDAuOA0KICAgICAqIH0NCiAgICAgKg0KICAgICAqIFRoaXMgY2xhc3MgY2FuIGJlIHJlbW92ZWQgaWYgdGhpcyBraW5kIG9mIHZpZXcgaXMgbm90IHVzZWQuDQogICAgICoNCiAgICAgKiBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gc2VsZWN0b3IgYSBzZWxlY3RvciB1c2VkIGZvciBzZWFyY2hpbmcNCiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucyAgIFZpZXcgb3B0aW9ucyBvYmplY3QNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBQcm9ncmVzc0JhclZpZXcoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCg0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnb3BhY2l0eSc6IDAuOA0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KDQogICAgICAgIHRoaXMuJGNvbnRhaW5lciA9IHRoaXMuJGluZGljYXRvcjsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ2RpdicpOw0KICAgIH0NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlID0gbmV3IFZpZXcoKTsNCiAgICBQcm9ncmVzc0JhclZpZXcuY29uc3RydWN0b3IgPSBQcm9ncmVzc0JhclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBQcm9ncmVzc0JhclZpZXcNCiAgICAgKi8NCiAgICBQcm9ncmVzc0JhclZpZXcucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbih0aW1lb3V0KSB7DQogICAgICAgIFZpZXcucHJvdG90eXBlLmluaXQuY2FsbCh0aGlzLCB0aW1lb3V0KTsNCg0KICAgICAgICB2YXIgb3BhY2l0eSA9IHRoaXMuc2V0dGluZ3Mub3BhY2l0eTsNCiAgICAgICAgdGhpcy4kY29udGFpbmVyLmNzcygnb3BhY2l0eScsIG9wYWNpdHkpOw0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IuY3NzKCdvcGFjaXR5Jywgb3BhY2l0eSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRpbmRpY2F0b3Iuc3RvcCh0cnVlKTsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLmNzcygnd2lkdGgnLCAnMHB4Jyk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kaW5kaWNhdG9yLnN0b3AodHJ1ZSk7DQogICAgfTsNCiAgICAvKioNCiAgICAgKiBAbWVtYmVyIFByb2dyZXNzQmFyVmlldw0KICAgICAqLw0KICAgIFByb2dyZXNzQmFyVmlldy5wcm90b3R5cGUucGxheSA9IGZ1bmN0aW9uKCkgew0KICAgICAgICB0aGlzLiRpbmRpY2F0b3IuYW5pbWF0ZSh7DQogICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScNCiAgICAgICAgfSwgdGhpcy50aW1lb3V0IC0gdGhpcy50aW1lRWxhcHNlZCwgJ2xpbmVhcicpOw0KICAgIH07DQogICAgLyoqDQogICAgICogZW5kIG9mIFByb2dyZXNzQmFyVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5Qcm9ncmVzc0JhclZpZXcgPSBQcm9ncmVzc0JhclZpZXc7DQoNCiAgICAvKioNCiAgICAgKiBSb3RhdG9yVmlldyBjbGFzcyBwcm92aWRlcyBhIGxvZ2ljIGZvciBhbmltYXRlIGEgJ3RpbWUgaW5kaWNhdG9yJywNCiAgICAgKiB0aGF0IHNob3dzIHRoZSBwcm9ncmVzcyBvZiB0aW1lIHdpdGggdGhlIGZpbGxpbmcgdXAgcmluZw0KICAgICAqDQogICAgICogT3B0aW9ucyBvYmplY3Q6DQogICAgICogew0KICAgICAqICAgICAnb3BhY2l0eSc6IE51bWJlciB2YWx1ZSAvL2JldHdlZW4gMCBhbmQgMTsgZGVmYXVsdCBpcyAwLjUNCiAgICAgKiB9DQogICAgICoNCiAgICAgKiBUaGlzIGNsYXNzIGNhbiBiZSByZW1vdmVkIGlmIHRoaXMga2luZCBvZiB2aWV3IGlzIG5vdCB1c2VkLg0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd9IHNlbGVjdG9yIGEgc2VsZWN0b3IgdXNlZCBmb3Igc2VhcmNoaW5nDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9wdGlvbnMgICBWaWV3IG9wdGlvbnMgb2JqZWN0DQogICAgICovDQogICAgZnVuY3Rpb24gUm90YXRvclZpZXcoc2VsZWN0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgVmlldy5jYWxsKHRoaXMsIHNlbGVjdG9yKTsNCg0KICAgICAgICB2YXIgZGVmYXVsdHMgPSB7DQogICAgICAgICAgICAnb3BhY2l0eSc6IDAuNQ0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuc2V0dGluZ3MgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOw0KICAgICAgICB0aGlzLiRtYXNrID0gdGhpcy4kaW5kaWNhdG9yLmZpbmQoJ3NwYW4ubWFzaycpLmZpcnN0KCk7DQogICAgICAgIHRoaXMuJHJvdGF0b3IgPSB0aGlzLiRpbmRpY2F0b3IuZmluZCgnc3Bhbi5yb3RhdG9yJykuZmlyc3QoKTsNCg0KICAgICAgICBmdW5jdGlvbiByb3RhdGVDc3MoZGVnKSB7DQogICAgICAgICAgICB2YXIgdmFsdWUgPSAncm90YXRlKCcgKyBkZWcgKyAnZGVnKSc7DQoNCiAgICAgICAgICAgIHJldHVybiB7DQogICAgICAgICAgICAgICAgJy13ZWJraXQtdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1tb3otdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJy1vLXRyYW5zZm9ybSc6IHZhbHVlLA0KICAgICAgICAgICAgICAgICctbXMtdHJhbnNmb3JtJzogdmFsdWUsDQogICAgICAgICAgICAgICAgJ3RyYW5zZm9ybSc6IHZhbHVlDQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIG9wdGlvbnMpIHsNCiAgICAgICAgICAgIHZhciBkZWZhdWx0cyA9IHsNCiAgICAgICAgICAgICAgICAgICAgJ2ZvbnRTaXplJzogJzE4MHB4JywNCiAgICAgICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAgICAgJ3N0ZXAnOiBmdW5jdGlvbihub3cpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm90YXRvci5jc3Mocm90YXRlQ3NzKG5vdykpOw0KICAgICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICAgICdlYXNpbmcnOiAnbGluZWFyJw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICBzZXR0aW5ncyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cywgb3B0aW9ucyk7DQoNCiAgICAgICAgICAgICRyb3RhdG9yLmFuaW1hdGUoew0KICAgICAgICAgICAgICAgICAgICAnZm9udC1zaXplJzogc2V0dGluZ3MuZm9udFNpemUNCiAgICAgICAgICAgICAgICB9LA0KICAgICAgICAgICAgICAgIHNldHRpbmdzLmFuaW1hdGVPcHRpb25zKTsNCiAgICAgICAgfQ0KDQogICAgICAgIGZ1bmN0aW9uIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgZHVyYXRpb24pIHsNCiAgICAgICAgICAgICRyb3RhdG9yLmFkZENsYXNzKCdoYWxmJyk7DQogICAgICAgICAgICAkbWFzay5hZGRDbGFzcygnaGFsZicpOw0KDQogICAgICAgICAgICBhbmltYXRlUm90YXRvcigkcm90YXRvciwgew0KICAgICAgICAgICAgICAgICdmb250U2l6ZSc6ICczNjBweCcsDQogICAgICAgICAgICAgICAgJ2FuaW1hdGVPcHRpb25zJzogew0KICAgICAgICAgICAgICAgICAgICAnZHVyYXRpb24nOiBkdXJhdGlvbg0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0pOw0KICAgICAgICB9DQoNCiAgICAgICAgZnVuY3Rpb24gcGhhc2VPbmVBbmltYXRpb24oJG1hc2ssICRyb3RhdG9yLCBkdXJhdGlvbiwgcGhhc2VUd29EdXJhdGlvbikgew0KICAgICAgICAgICAgYW5pbWF0ZVJvdGF0b3IoJHJvdGF0b3IsIHsNCiAgICAgICAgICAgICAgICAnYW5pbWF0ZU9wdGlvbnMnOiB7DQogICAgICAgICAgICAgICAgICAgICdkdXJhdGlvbic6IGR1cmF0aW9uLA0KICAgICAgICAgICAgICAgICAgICAnY29tcGxldGUnOiBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgIHBoYXNlVHdvQW5pbWF0aW9uKCRtYXNrLCAkcm90YXRvciwgcGhhc2VUd29EdXJhdGlvbik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KTsNCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVzZXRDc3MgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IucmVtb3ZlQ2xhc3MoJ2hhbGYnKTsNCiAgICAgICAgICAgIHRoaXMuJHJvdGF0b3IuY3NzKHJvdGF0ZUNzcygwKSk7DQogICAgICAgICAgICB0aGlzLiRyb3RhdG9yLmNzcygnZm9udC1zaXplJywgJzBweCcpOw0KDQogICAgICAgICAgICB0aGlzLiRtYXNrLnJlbW92ZUNsYXNzKCdoYWxmJyk7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5wbGF5UGhhc2VPbmUgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgICAgIHZhciBkdXJhdGlvbiA9IHRoaXMudGltZW91dCAvIDIgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VPbmVBbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24sIHRoaXMudGltZW91dCAvIDIpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMucGxheVBoYXNlVHdvID0gZnVuY3Rpb24oKSB7DQogICAgICAgICAgICB2YXIgZHVyYXRpb24gPSB0aGlzLnRpbWVvdXQgLSB0aGlzLnRpbWVFbGFwc2VkOw0KICAgICAgICAgICAgcGhhc2VUd29BbmltYXRpb24odGhpcy4kbWFzaywgdGhpcy4kcm90YXRvciwgZHVyYXRpb24pOw0KICAgICAgICB9Ow0KICAgIH0NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUgPSBuZXcgVmlldygpOw0KICAgIFJvdGF0b3JWaWV3LmNvbnN0cnVjdG9yID0gUm90YXRvclZpZXc7DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odGltZW91dCkgew0KICAgICAgICBWaWV3LnByb3RvdHlwZS5pbml0LmNhbGwodGhpcywgdGltZW91dCk7DQoNCiAgICAgICAgaWYgKGlzVHJhbnNmb3JtU3VwcG9ydGVkKCkpIHsNCiAgICAgICAgICAgIHRoaXMuJGluZGljYXRvci5zaG93KCk7DQogICAgICAgICAgICB0aGlzLiRtYXNrLmNzcygnb3BhY2l0eScsIHRoaXMuc2V0dGluZ3Mub3BhY2l0eSk7DQogICAgICAgIH0NCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgVmlldy5wcm90b3R5cGUucmVzZXQuY2FsbCh0aGlzKTsNCg0KICAgICAgICB0aGlzLiRyb3RhdG9yLnN0b3AodHJ1ZSk7DQogICAgICAgIHRoaXMucmVzZXRDc3MoKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIEBtZW1iZXIgUm90YXRvclZpZXcNCiAgICAgKi8NCiAgICBSb3RhdG9yVmlldy5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbigpIHsNCiAgICAgICAgdGhpcy4kcm90YXRvci5zdG9wKHRydWUpOw0KICAgIH07DQogICAgLyoqDQogICAgICogQG1lbWJlciBSb3RhdG9yVmlldw0KICAgICAqLw0KICAgIFJvdGF0b3JWaWV3LnByb3RvdHlwZS5wbGF5ID0gZnVuY3Rpb24oKSB7DQogICAgICAgIHZhciBwaGFzZSA9IHRoaXMucGxheVBoYXNlT25lOw0KICAgICAgICBpZiAodGhpcy50aW1lRWxhcHNlZCA+PSB0aGlzLnRpbWVvdXQgLyAyKSB7DQogICAgICAgICAgICBwaGFzZSA9IHRoaXMucGxheVBoYXNlVHdvOw0KICAgICAgICB9DQoNCiAgICAgICAgcGhhc2UuY2FsbCh0aGlzKTsNCiAgICB9Ow0KICAgIC8qKg0KICAgICAqIGVuZCBvZiBSb3RhdG9yVmlldyBjbGFzcw0KICAgICAqLw0KICAgIHB1Yi5Sb3RhdG9yVmlldyA9IFJvdGF0b3JWaWV3Ow0KDQogICAgcmV0dXJuIHB1YjsNCn0oalF1ZXJ5KSk7DQovKioNCiAqIGVuZCBvZiBYQS5jb21wb25lbnQuY2Fyb3VzZWxzLkluZGljYXRvclZpZXdzIG1vZHVsZS4NCiAqLw==
- ID: "6954b7c7-2487-423f-8600-436cb3b6dc0e"
  Hint: Size
  Value: 68425
- ID: "6f47a0a5-9c94-4b48-abeb-42d38def6054"
  Hint: Mime Type
  Value: "application/x-javascript"
- ID: "c06867fe-9a43-4c7d-b739-48780492d06f"
  Hint: Extension
  Value: js
Languages:
- Language: en
  Versions:
  - Version: 1
    Fields:
    - ID: "25bed78c-4957-4165-998a-ca1b52f67497"
      Hint: __Created
      Value: 20160811T135342Z
